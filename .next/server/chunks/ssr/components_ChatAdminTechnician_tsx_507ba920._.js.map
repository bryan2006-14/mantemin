{"version":3,"sources":["../../../../components/ChatAdminTechnician.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n\r\ninterface Message {\r\n  id: string;\r\n  conversation_id: string;\r\n  sender_id: string;\r\n  sender_type: string;\r\n  message: string;\r\n  created_at: string;\r\n  read: boolean;\r\n}\r\n\r\ninterface Conversation {\r\n  id: string;\r\n  admin_id: string;\r\n  technician_id: string;\r\n  last_message: string;\r\n  updated_at: string;\r\n  other_user_name?: string;\r\n  unread_count: number; // Cambiado de opcional a requerido\r\n}\r\n\r\ninterface Usuario {\r\n  id: string;\r\n  email: string;\r\n  nombre: string;\r\n  rol: string;\r\n}\r\n\r\n// Helper functions para formatear fechas (sin date-fns)\r\nconst formatTime = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  return date.toLocaleTimeString('es-PE', { \r\n    hour: '2-digit', \r\n    minute: '2-digit',\r\n    hour12: false \r\n  });\r\n};\r\n\r\nconst formatDate = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  const now = new Date();\r\n  const diffInMs = now.getTime() - date.getTime();\r\n  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\r\n  \r\n  const daysOfWeek = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];\r\n  const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];\r\n  \r\n  if (diffInDays === 0) {\r\n    return formatTime(dateString);\r\n  } else if (diffInDays === 1) {\r\n    return `Ayer ${formatTime(dateString)}`;\r\n  } else if (diffInDays < 7) {\r\n    return `${daysOfWeek[date.getDay()]} ${formatTime(dateString)}`;\r\n  } else {\r\n    return `${date.getDate()}/${months[date.getMonth()]} ${formatTime(dateString)}`;\r\n  }\r\n};\r\n\r\nconst formatConversationTime = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  const now = new Date();\r\n  const diffInMs = now.getTime() - date.getTime();\r\n  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\r\n  \r\n  const daysOfWeek = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];\r\n  \r\n  if (diffInDays === 0) {\r\n    return formatTime(dateString);\r\n  } else if (diffInDays === 1) {\r\n    return \"Ayer\";\r\n  } else if (diffInDays < 7) {\r\n    return daysOfWeek[date.getDay()];\r\n  } else {\r\n    return `${date.getDate()}/${date.getMonth() + 1}`;\r\n  }\r\n};\r\n\r\n// Componente de mensaje individual\r\nconst MessageItem = ({ \r\n  msg, \r\n  currentUser, \r\n  onEdit, \r\n  onDelete,\r\n  isEditing,\r\n  editText,\r\n  onSaveEdit,\r\n  onCancelEdit,\r\n  onSetEditText\r\n}: {\r\n  msg: Message;\r\n  currentUser: Usuario | null;\r\n  onEdit: (msg: Message) => void;\r\n  onDelete: (messageId: string) => void;\r\n  isEditing: boolean;\r\n  editText: string;\r\n  onSaveEdit: (messageId: string) => void;\r\n  onCancelEdit: () => void;\r\n  onSetEditText: (text: string) => void;\r\n}) => {\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  const isOwn = msg.sender_id === currentUser?.id;\r\n\r\n  // Cerrar men√∫ al hacer clic fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        setMenuOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  if (isEditing) {\r\n    return (\r\n      <div className={`flex ${isOwn ? \"justify-end\" : \"justify-start\"} mb-2`}>\r\n        <div className=\"max-w-xs lg:max-w-md w-full\">\r\n          <div className=\"bg-blue-50 p-3 rounded-2xl rounded-br-none border border-blue-100\">\r\n            <textarea\r\n              value={editText}\r\n              onChange={(e) => onSetEditText(e.target.value)}\r\n              className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none\"\r\n              rows={3}\r\n              autoFocus\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  e.preventDefault();\r\n                  onSaveEdit(msg.id);\r\n                }\r\n                if (e.key === 'Escape') {\r\n                  onCancelEdit();\r\n                }\r\n              }}\r\n            />\r\n            <div className=\"flex justify-end space-x-2 mt-2\">\r\n              <button\r\n                onClick={() => onSaveEdit(msg.id)}\r\n                className=\"px-3 py-1 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors\"\r\n                disabled={!editText.trim()}\r\n              >\r\n                ‚úì Guardar\r\n              </button>\r\n              <button\r\n                onClick={onCancelEdit}\r\n                className=\"px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300 transition-colors\"\r\n              >\r\n                ‚úï Cancelar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`flex ${isOwn ? \"justify-end\" : \"justify-start\"} mb-2 group`}>\r\n      <div className=\"relative max-w-xs lg:max-w-md\" ref={menuRef}>\r\n        <div\r\n          className={`px-4 py-3 rounded-2xl ${isOwn\r\n            ? \"bg-blue-600 text-white rounded-br-none\"\r\n            : \"bg-white text-gray-900 rounded-bl-none shadow-sm\"\r\n            } hover:shadow-md transition-shadow`}\r\n        >\r\n          <p className=\"break-words whitespace-pre-wrap\">{msg.message}</p>\r\n          <div className=\"flex items-center justify-end mt-1\">\r\n            <span className={`text-xs ${isOwn ? \"text-blue-200\" : \"text-gray-400\"}`}>\r\n              {formatDate(msg.created_at)}\r\n              {msg.read && isOwn && \" ‚úì‚úì\"}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Bot√≥n de opciones - disponible para todos los mensajes */}\r\n        <div className={`absolute top-0 ${isOwn ? '-left-8' : '-right-8'} opacity-0 group-hover:opacity-100 transition-opacity`}>\r\n          <button\r\n            onClick={() => setMenuOpen(!menuOpen)}\r\n            className=\"p-1.5 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors shadow-sm\"\r\n          >\r\n            <svg className=\"w-4 h-4 text-gray-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path d=\"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z\" />\r\n            </svg>\r\n          </button>\r\n\r\n          {menuOpen && (\r\n            <div className={`absolute ${isOwn ? 'left-0' : 'right-0'} mt-1 bg-white shadow-lg rounded-lg py-1 z-50 w-40 border border-gray-100`}>\r\n              {/* Solo el remitente puede editar */}\r\n              {isOwn && (\r\n                <button\r\n                  onClick={() => {\r\n                    onEdit(msg);\r\n                    setMenuOpen(false);\r\n                  }}\r\n                  className=\"w-full px-4 py-2 text-left text-sm hover:bg-blue-50 flex items-center space-x-2 text-gray-700\"\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                  </svg>\r\n                  <span>Editar</span>\r\n                </button>\r\n              )}\r\n              \r\n              {/* Todos pueden eliminar */}\r\n              <button\r\n                onClick={() => {\r\n                  if (confirm(\"¬øEst√°s seguro de eliminar este mensaje para todos?\")) {\r\n                    onDelete(msg.id);\r\n                  }\r\n                  setMenuOpen(false);\r\n                }}\r\n                className=\"w-full px-4 py-2 text-left text-sm hover:bg-red-50 flex items-center space-x-2 text-red-600\"\r\n              >\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                </svg>\r\n                <span>Eliminar para todos</span>\r\n              </button>\r\n              \r\n              {/* Opci√≥n de responder/citar mensaje */}\r\n              <div className=\"border-t border-gray-100 my-1\"></div>\r\n              <button\r\n                onClick={() => {\r\n                  // Implementar funcionalidad de responder\r\n                  setMenuOpen(false);\r\n                }}\r\n                className=\"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center space-x-2 text-gray-700\"\r\n              >\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6\" />\r\n                </svg>\r\n                <span>Responder</span>\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default function ChatAdminTechnician() {\r\n  const [currentUser, setCurrentUser] = useState<Usuario | null>(null);\r\n  const [conversations, setConversations] = useState<Conversation[]>([]);\r\n  const [technicians, setTechnicians] = useState<Usuario[]>([]);\r\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [editingMessage, setEditingMessage] = useState<string | null>(null);\r\n  const [editText, setEditText] = useState(\"\");\r\n  const [isSending, setIsSending] = useState(false);\r\n  const [typing, setTyping] = useState(false);\r\n  const [lastTypingTime, setLastTypingTime] = useState(0);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const conversationListRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Cargar usuario actual\r\n  useEffect(() => {\r\n    loadCurrentUser();\r\n    \r\n    // Configurar intervalo para actualizaciones peri√≥dicas\r\n    const interval = setInterval(() => {\r\n      if (currentUser) {\r\n        loadConversations();\r\n        if (selectedConversation) {\r\n          checkUnreadCount(selectedConversation);\r\n        }\r\n      }\r\n    }, 30000); // Actualizar cada 30 segundos\r\n\r\n    return () => clearInterval(interval);\r\n  }, [currentUser, selectedConversation]);\r\n\r\n  // Cargar conversaciones y t√©cnicos cuando cambia el usuario\r\n  useEffect(() => {\r\n    if (currentUser) {\r\n      console.log(\"‚úÖ Current user:\", currentUser);\r\n      if (currentUser.rol === \"admin\") {\r\n        loadTechnicians();\r\n      }\r\n      loadConversations();\r\n    }\r\n  }, [currentUser]);\r\n\r\n  // Cargar mensajes cuando se selecciona conversaci√≥n\r\n  useEffect(() => {\r\n    if (selectedConversation) {\r\n      loadMessages(selectedConversation);\r\n      markMessagesAsRead(selectedConversation);\r\n    }\r\n  }, [selectedConversation]);\r\n\r\n  // Suscripci√≥n en tiempo real mejorada\r\n  useEffect(() => {\r\n    if (selectedConversation && currentUser) {\r\n      const channel = supabase\r\n        .channel(`realtime-messages-${selectedConversation}`)\r\n        .on(\r\n          \"postgres_changes\",\r\n          {\r\n            event: \"*\",\r\n            schema: \"public\",\r\n            table: \"messages\",\r\n            filter: `conversation_id=eq.${selectedConversation}`,\r\n          },\r\n          (payload) => {\r\n            handleRealtimeUpdate(payload);\r\n          }\r\n        )\r\n        .on(\r\n          \"postgres_changes\",\r\n          {\r\n            event: \"UPDATE\",\r\n            schema: \"public\",\r\n            table: \"conversations\",\r\n            filter: `id=eq.${selectedConversation}`,\r\n          },\r\n          (payload) => {\r\n            console.log(\"üîÑ Conversaci√≥n actualizada:\", payload.new);\r\n            // Actualizar conversaci√≥n en la lista\r\n            setConversations(prev => \r\n              prev.map(conv => \r\n                conv.id === payload.new.id \r\n                  ? { ...conv, ...payload.new, last_message: payload.new.last_message }\r\n                  : conv\r\n              )\r\n            );\r\n          }\r\n        )\r\n        .subscribe((status) => {\r\n          console.log(\"üì° Canal de realtime:\", status);\r\n        });\r\n\r\n      return () => {\r\n        supabase.removeChannel(channel);\r\n      };\r\n    }\r\n  }, [selectedConversation, currentUser]);\r\n\r\n  const handleRealtimeUpdate = useCallback((payload: any) => {\r\n    console.log(\"üì° Evento realtime:\", payload.eventType, payload.new);\r\n    \r\n    switch (payload.eventType) {\r\n      case \"INSERT\":\r\n        setMessages(prev => {\r\n          // Evitar duplicados\r\n          if (prev.some(msg => msg.id === payload.new.id)) return prev;\r\n          return [...prev, payload.new as Message];\r\n        });\r\n        scrollToBottom();\r\n        break;\r\n        \r\n      case \"UPDATE\":\r\n        setMessages(prev =>\r\n          prev.map(msg => (msg.id === payload.new.id ? payload.new as Message : msg))\r\n        );\r\n        break;\r\n        \r\n      case \"DELETE\":\r\n        setMessages(prev => prev.filter(msg => msg.id !== payload.old.id));\r\n        break;\r\n    }\r\n  }, []);\r\n\r\n  // Detectar cuando el usuario est√° escribiendo\r\n  useEffect(() => {\r\n    const typingTimeout = setTimeout(() => {\r\n      setTyping(false);\r\n    }, 1500);\r\n\r\n    return () => clearTimeout(typingTimeout);\r\n  }, [newMessage]);\r\n\r\n  const scrollToBottom = () => {\r\n    setTimeout(() => {\r\n      messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, 100);\r\n  };\r\n\r\n  const scrollConversationToTop = () => {\r\n    if (conversationListRef.current) {\r\n      conversationListRef.current.scrollTop = 0;\r\n    }\r\n  };\r\n\r\n  const loadCurrentUser = async () => {\r\n    try {\r\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n      \r\n      if (authError || !user) {\r\n        setError(\"‚ùå No hay usuario autenticado\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      let { data: usuario, error: usuarioError } = await supabase\r\n        .from(\"usuarios\")\r\n        .select(\"*\")\r\n        .eq(\"id\", user.id)\r\n        .maybeSingle();\r\n      \r\n      if (!usuario) {\r\n        console.log(\"‚ö†Ô∏è Usuario no existe en tabla usuarios, creando...\");\r\n        \r\n        const { data: nuevoUsuario, error: insertError } = await supabase\r\n          .from(\"usuarios\")\r\n          .insert({\r\n            id: user.id,\r\n            email: user.email,\r\n            nombre: user.email?.split('@')[0] || 'Usuario',\r\n            rol: 'tecnico',\r\n            activo: true\r\n          })\r\n          .select()\r\n          .single();\r\n\r\n        if (insertError) {\r\n          console.error(\"‚ùå Error creando usuario:\", insertError);\r\n          setError(\"No se pudo crear el usuario en la base de datos. Error: \" + insertError.message);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        usuario = nuevoUsuario;\r\n      }\r\n\r\n      setCurrentUser(usuario);\r\n      setLoading(false);\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error:\", err);\r\n      setError(\"Error general: \" + err.message);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadTechnicians = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"usuarios\")\r\n        .select(\"*\")\r\n        .eq(\"rol\", \"tecnico\")\r\n        .order(\"nombre\", { ascending: true });\r\n      \r\n      if (error) throw error;\r\n      setTechnicians(data || []);\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error cargando t√©cnicos:\", err);\r\n    }\r\n  };\r\n\r\n  const loadConversations = async () => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      let query;\r\n      if (currentUser.rol === \"admin\") {\r\n        query = supabase\r\n          .from(\"conversations\")\r\n          .select(\"*\")\r\n          .eq(\"admin_id\", currentUser.id)\r\n          .order(\"updated_at\", { ascending: false });\r\n      } else {\r\n        query = supabase\r\n          .from(\"conversations\")\r\n          .select(\"*\")\r\n          .eq(\"technician_id\", currentUser.id)\r\n          .order(\"updated_at\", { ascending: false });\r\n      }\r\n\r\n      const { data, error } = await query;\r\n      \r\n      if (error) throw error;\r\n\r\n      if (data && data.length > 0) {\r\n        const conversationsWithNames = await Promise.all(\r\n          data.map(async (conv) => {\r\n            const otherId = currentUser.rol === \"admin\" ? conv.technician_id : conv.admin_id;\r\n            \r\n            const { data: otherUser } = await supabase\r\n              .from(\"usuarios\")\r\n              .select(\"nombre, email\")\r\n              .eq(\"id\", otherId)\r\n              .single();\r\n            \r\n            // Calcular mensajes no le√≠dos\r\n            const { count } = await supabase\r\n              .from(\"messages\")\r\n              .select(\"*\", { count: \"exact\", head: true })\r\n              .eq(\"conversation_id\", conv.id)\r\n              .neq(\"sender_id\", currentUser.id)\r\n              .eq(\"read\", false);\r\n\r\n            return {\r\n              ...conv,\r\n              other_user_name: otherUser?.nombre || otherUser?.email || \"Usuario\",\r\n              unread_count: count || 0 // Siempre tendr√° un valor\r\n            };\r\n          })\r\n        );\r\n        \r\n        setConversations(conversationsWithNames);\r\n      } else {\r\n        setConversations([]);\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error cargando conversaciones:\", err);\r\n    }\r\n  };\r\n\r\n  const loadMessages = async (conversationId: string) => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"messages\")\r\n        .select(\"*\")\r\n        .eq(\"conversation_id\", conversationId)\r\n        .order(\"created_at\", { ascending: true });\r\n      \r\n      if (error) throw error;\r\n      setMessages(data || []);\r\n      setTimeout(scrollToBottom, 100);\r\n    } catch (err) {\r\n      console.error(\"‚ùå Error cargando mensajes:\", err);\r\n    }\r\n  };\r\n\r\n  const markMessagesAsRead = async (conversationId: string) => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      await supabase\r\n        .from(\"messages\")\r\n        .update({ read: true })\r\n        .eq(\"conversation_id\", conversationId)\r\n        .neq(\"sender_id\", currentUser.id);\r\n      \r\n      // Actualizar contador en conversaciones\r\n      setConversations(prev =>\r\n        prev.map(conv =>\r\n          conv.id === conversationId ? { ...conv, unread_count: 0 } : conv\r\n        )\r\n      );\r\n    } catch (err) {\r\n      console.error(\"‚ùå Error marcando mensajes como le√≠dos:\", err);\r\n    }\r\n  };\r\n\r\n  const checkUnreadCount = async (conversationId: string) => {\r\n    if (!currentUser) return;\r\n\r\n    const { count } = await supabase\r\n      .from(\"messages\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"conversation_id\", conversationId)\r\n      .neq(\"sender_id\", currentUser.id)\r\n      .eq(\"read\", false);\r\n\r\n    setConversations(prev =>\r\n      prev.map(conv =>\r\n        conv.id === conversationId ? { ...conv, unread_count: count || 0 } : conv\r\n      )\r\n    );\r\n  };\r\n\r\n  const startConversation = async (technicianId: string) => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      const { data: existing, error: searchError } = await supabase\r\n        .from(\"conversations\")\r\n        .select(\"*\")\r\n        .eq(\"admin_id\", currentUser.id)\r\n        .eq(\"technician_id\", technicianId)\r\n        .maybeSingle();\r\n\r\n      if (searchError) throw searchError;\r\n\r\n      if (existing) {\r\n        setSelectedConversation(existing.id);\r\n        return;\r\n      }\r\n\r\n      const { data: newConv, error: insertError } = await supabase\r\n        .from(\"conversations\")\r\n        .insert({\r\n          admin_id: currentUser.id,\r\n          technician_id: technicianId,\r\n          last_message: \"\",\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (insertError) throw insertError;\r\n\r\n      if (newConv) {\r\n        await loadConversations();\r\n        setSelectedConversation(newConv.id);\r\n        scrollConversationToTop();\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error creando conversaci√≥n:\", err);\r\n      setError(\"Error al crear conversaci√≥n: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !selectedConversation || !currentUser || isSending) return;\r\n\r\n    setIsSending(true);\r\n    const messageToSend = newMessage.trim();\r\n    const senderType = currentUser.rol === \"admin\" ? \"admin\" : \"tecnico\";\r\n\r\n    try {\r\n      // Enviar mensaje\r\n      const { error } = await supabase.from(\"messages\").insert({\r\n        conversation_id: selectedConversation,\r\n        sender_id: currentUser.id,\r\n        sender_type: senderType,\r\n        message: messageToSend,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      // Actualizar conversaci√≥n\r\n      await supabase\r\n        .from(\"conversations\")\r\n        .update({\r\n          last_message: messageToSend,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", selectedConversation);\r\n\r\n      // Actualizar UI inmediatamente\r\n      setNewMessage(\"\");\r\n      setTyping(false);\r\n      \r\n      // Forzar recarga de conversaciones para actualizar orden\r\n      await loadConversations();\r\n      \r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error enviando mensaje:\", err);\r\n      alert(\"Error al enviar mensaje: \" + err.message);\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  };\r\n\r\n  const deleteMessage = async (messageId: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"messages\")\r\n        .delete()\r\n        .eq(\"id\", messageId);\r\n\r\n      if (error) throw error;\r\n      \r\n      console.log(\"‚úÖ Mensaje eliminado para todos\");\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error eliminando mensaje:\", err);\r\n      alert(\"Error al eliminar mensaje: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const startEdit = (message: Message) => {\r\n    setEditingMessage(message.id);\r\n    setEditText(message.message);\r\n  };\r\n\r\n  const saveEdit = async (messageId: string) => {\r\n    if (!editText.trim()) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"messages\")\r\n        .update({ message: editText.trim() })\r\n        .eq(\"id\", messageId);\r\n\r\n      if (error) throw error;\r\n      \r\n      setEditingMessage(null);\r\n      setEditText(\"\");\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error editando mensaje:\", err);\r\n      alert(\"Error al editar mensaje: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const cancelEdit = () => {\r\n    setEditingMessage(null);\r\n    setEditText(\"\");\r\n  };\r\n\r\n  const handleTyping = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setNewMessage(e.target.value);\r\n    setTyping(true);\r\n    setLastTypingTime(Date.now());\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600 font-medium\">Cargando chat...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\r\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8\">\r\n          <div className=\"text-center mb-6\">\r\n            <div className=\"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <span className=\"text-3xl\">‚ö†Ô∏è</span>\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-red-600 mb-2\">Error</h2>\r\n            <p className=\"text-gray-700 mb-6\">{error}</p>\r\n            <button\r\n              onClick={() => window.location.reload()}\r\n              className=\"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all font-medium\"\r\n            >\r\n              Recargar p√°gina\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!currentUser) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\r\n        <div className=\"text-center bg-white p-10 rounded-2xl shadow-xl\">\r\n          <div className=\"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n            <span className=\"text-4xl\">üîí</span>\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold mb-2\">No autenticado</h2>\r\n          <p className=\"text-gray-600 mb-6\">Por favor inicia sesi√≥n</p>\r\n          <button\r\n            onClick={() => window.location.href = \"/login\"}\r\n            className=\"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all\"\r\n          >\r\n            Ir a login\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-gradient-to-br from-gray-50 to-blue-50\">\r\n      {/* Sidebar - Lista de conversaciones */}\r\n      <div className=\"w-80 bg-white border-r border-gray-200 flex flex-col shadow-lg\">\r\n        <div className=\"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-purple-600\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-2xl font-bold text-white\">üí¨ Mensajes</h2>\r\n            <button\r\n              onClick={loadConversations}\r\n              className=\"p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors\"\r\n              title=\"Actualizar conversaciones\"\r\n            >\r\n              <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n          <p className=\"text-sm text-blue-100 mb-2\">\r\n            {currentUser?.rol === \"admin\" ? \"Chat con T√©cnicos\" : \"Chat con Admin\"}\r\n          </p>\r\n          <div className=\"flex items-center space-x-2\">\r\n            <div className=\"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center\">\r\n              <span className=\"text-white font-bold text-sm\">\r\n                {currentUser.nombre?.charAt(0).toUpperCase()}\r\n              </span>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-white\">{currentUser.nombre}</span>\r\n            <span className=\"px-2 py-0.5 bg-white/30 text-xs text-white rounded-full\">\r\n              {currentUser.rol}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {currentUser?.rol === \"admin\" && (\r\n          <div className=\"p-4 border-b border-gray-200\">\r\n            {technicians.length === 0 ? (\r\n              <div className=\"text-center p-3 bg-yellow-50 rounded-xl border border-yellow-100\">\r\n                <p className=\"text-sm text-yellow-700 font-medium\">‚ö†Ô∏è No hay t√©cnicos disponibles</p>\r\n              </div>\r\n            ) : (\r\n              <select\r\n                onChange={(e) => {\r\n                  if (e.target.value) startConversation(e.target.value);\r\n                }}\r\n                value=\"\"\r\n                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all bg-white hover:border-gray-400\"\r\n              >\r\n                <option value=\"\">‚ûï Nueva conversaci√≥n</option>\r\n                {technicians.map((tech) => (\r\n                  <option key={tech.id} value={tech.id}>\r\n                    üë®‚Äçüîß {tech.nombre}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex-1 overflow-y-auto\" ref={conversationListRef}>\r\n          {conversations.length === 0 ? (\r\n            <div className=\"p-8 text-center\">\r\n              <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                <span className=\"text-3xl\">üí¨</span>\r\n              </div>\r\n              <p className=\"font-semibold text-gray-700 mb-2\">No hay conversaciones</p>\r\n              {currentUser.rol === \"admin\" ? (\r\n                <p className=\"text-sm text-gray-500\">Selecciona un t√©cnico arriba</p>\r\n              ) : (\r\n                <p className=\"text-sm text-gray-500\">Espera a que el admin te contacte</p>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            conversations.map((conv) => (\r\n              <div\r\n                key={conv.id}\r\n                onClick={() => setSelectedConversation(conv.id)}\r\n                className={`p-4 border-b border-gray-100 cursor-pointer transition-all hover:bg-gray-50 active:bg-gray-100\r\n                  ${selectedConversation === conv.id \r\n                    ? \"bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-l-blue-500\" \r\n                    : \"\"}`}\r\n              >\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"relative\">\r\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-lg\">\r\n                      {conv.other_user_name?.charAt(0).toUpperCase()}\r\n                    </div>\r\n                    {conv.unread_count > 0 && (\r\n                      <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center\">\r\n                        <span className=\"text-xs font-bold text-white\">{conv.unread_count}</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <h4 className=\"font-semibold text-gray-900 truncate\">\r\n                        {conv.other_user_name}\r\n                      </h4>\r\n                      <span className=\"text-xs text-gray-400 whitespace-nowrap\">\r\n                        {formatConversationTime(conv.updated_at)}\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-sm text-gray-500 truncate mt-1\">\r\n                      {conv.last_message || \"Sin mensajes\"}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Panel de chat principal */}\r\n      <div className=\"flex-1 flex flex-col\">\r\n        {selectedConversation ? (\r\n          <>\r\n            <div className=\"p-4 bg-white border-b border-gray-200 shadow-sm\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"relative\">\r\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg\">\r\n                      {conversations\r\n                        .find((c) => c.id === selectedConversation)\r\n                        ?.other_user_name?.charAt(0)\r\n                        .toUpperCase()}\r\n                    </div>\r\n                    <div className=\"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"></div>\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"font-bold text-gray-900 text-lg\">\r\n                      {conversations.find((c) => c.id === selectedConversation)?.other_user_name}\r\n                    </h3>\r\n                    <p className=\"text-sm text-green-600 font-medium flex items-center\">\r\n                      <span className=\"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse\"></span>\r\n                      En l√≠nea ‚Ä¢ Activo ahora\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  {typing && (\r\n                    <div className=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm animate-pulse\">\r\n                      Escribiendo...\r\n                    </div>\r\n                  )}\r\n                  <button\r\n                    onClick={() => loadMessages(selectedConversation)}\r\n                    className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-colors\"\r\n                    title=\"Actualizar mensajes\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-y-auto p-4 bg-gradient-to-b from-gray-50 to-blue-50\">\r\n              {messages.length === 0 ? (\r\n                <div className=\"flex items-center justify-center h-full\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"w-24 h-24 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                      <span className=\"text-4xl\">üëã</span>\r\n                    </div>\r\n                    <h3 className=\"text-xl font-bold text-gray-700 mb-2\">¬°Inicia la conversaci√≥n!</h3>\r\n                    <p className=\"text-gray-500\">Env√≠a tu primer mensaje</p>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-2\">\r\n                  {messages.map((msg) => (\r\n                    <MessageItem\r\n                      key={msg.id}\r\n                      msg={msg}\r\n                      currentUser={currentUser}\r\n                      onEdit={startEdit}\r\n                      onDelete={deleteMessage}\r\n                      isEditing={editingMessage === msg.id}\r\n                      editText={editText}\r\n                      onSaveEdit={saveEdit}\r\n                      onCancelEdit={cancelEdit}\r\n                      onSetEditText={setEditText}\r\n                    />\r\n                  ))}\r\n                  <div ref={messagesEndRef} />\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <form onSubmit={sendMessage} className=\"p-4 bg-white border-t border-gray-200 shadow-lg\">\r\n              <div className=\"flex space-x-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={newMessage}\r\n                  onChange={handleTyping}\r\n                  placeholder=\"Escribe un mensaje...\"\r\n                  className=\"flex-1 p-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\r\n                  disabled={isSending}\r\n                />\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={!newMessage.trim() || isSending}\r\n                  className=\"px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed font-bold flex items-center space-x-2\"\r\n                >\r\n                  {isSending ? (\r\n                    <>\r\n                      <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\r\n                      <span>Enviando...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <span>Enviar</span>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\r\n                      </svg>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </>\r\n        ) : (\r\n          <div className=\"flex-1 flex items-center justify-center bg-gradient-to-br from-gray-50 to-blue-50\">\r\n            <div className=\"text-center max-w-md\">\r\n              <div className=\"w-32 h-32 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-8\">\r\n                <span className=\"text-6xl\">üí¨</span>\r\n              </div>\r\n              <h3 className=\"text-3xl font-bold text-gray-900 mb-4\">\r\n                Bienvenido al chat\r\n              </h3>\r\n              <p className=\"text-gray-600 text-lg mb-8\">\r\n                {currentUser.rol === \"admin\" \r\n                  ? \"Selecciona un t√©cnico para empezar a conversar\" \r\n                  : \"Espera a que el administrador inicie una conversaci√≥n contigo\"}\r\n              </p>\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">üöÄ</div>\r\n                  <p className=\"font-medium\">Chat en tiempo real</p>\r\n                </div>\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">üì±</div>\r\n                  <p className=\"font-medium\">Responsive design</p>\r\n                </div>\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">üîî</div>\r\n                  <p className=\"font-medium\">Notificaciones</p>\r\n                </div>\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">‚úèÔ∏è</div>\r\n                  <p className=\"font-medium\">Editar mensajes</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}