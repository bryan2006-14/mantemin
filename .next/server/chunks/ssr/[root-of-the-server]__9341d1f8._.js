module.exports=[36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},41997,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={BailoutToCSRError:function(){return g},isBailoutToCSRError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="BAILOUT_TO_CLIENT_SIDE_RENDERING";class g extends Error{constructor(a){super(`Bail out to client-side rendering: ${a}`),this.reason=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===f}},46058,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},39118,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__"},54427,(a,b,c)=>{"use strict";function d(){let a,b,c=new Promise((c,d)=>{a=c,b=d});return{resolve:a,reject:b,promise:c}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"createPromiseWithResolvers",{enumerable:!0,get:function(){return d}})},47733,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(966);function f(){let a=(0,d.useRouter)(),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)({codigo:"",marca:"",modelo:"",cliente_id:"",descripcion:"",estado:"operativo",foto_url:""});async function p(){let{data:a,error:b}=await e.supabase.from("clientes").select("id, nombre").order("nombre");!b&&a?m(a):console.error("Error al cargar clientes:",b)}(0,c.useEffect)(()=>{p()},[]);let q=async()=>{try{let{data:a,error:b}=await e.supabase.from("maquinas").select("codigo").order("id",{ascending:!1}).limit(1);if(!b&&a&&a.length>0){let b=a[0].codigo.replace(/\D/g,""),c=parseInt(b)||0,d=`MAQ-${String(c+1).padStart(4,"0")}`;o(a=>({...a,codigo:d}))}else o(a=>({...a,codigo:"MAQ-0001"}))}catch(b){console.error("Error al generar cÃ³digo:",b);let a=Date.now().toString().slice(-6);o(b=>({...b,codigo:`MAQ-${a}`}))}},r=a=>{let{name:b,value:c}=a.target;o(a=>({...a,[b]:c}))},s=async a=>{let b=a.target.files?.[0];if(b){if(!b.type.startsWith("image/"))return void alert("Por favor selecciona una imagen vÃ¡lida");if(b.size>5242880)return void alert("La imagen no debe superar los 5MB");try{i(!0);let a=b.name.split(".").pop(),c=`${Date.now()}-${Math.random().toString(36).substring(7)}.${a}`,d=`maquinas/${c}`,{data:f,error:g}=await e.supabase.storage.from("imagenes").upload(d,b,{cacheControl:"3600",upsert:!1});if(g){console.error("Error al subir imagen:",g),g.message.includes("Bucket not found")?alert('âŒ Error: El bucket "imagenes" no existe en Supabase.\n\nðŸ“ Pasos para solucionarlo:\n1. Ve a tu proyecto en Supabase\n2. Abre Storage en el menÃº lateral\n3. Crea un nuevo bucket llamado "imagenes"\n4. MÃ¡rcalo como pÃºblico (Public bucket)\n5. Guarda y vuelve a intentar'):alert("Error al subir la imagen: "+g.message);return}let{data:h}=e.supabase.storage.from("imagenes").getPublicUrl(d),j=h.publicUrl;console.log("Imagen subida exitosamente:",j),o(a=>({...a,foto_url:j})),k(URL.createObjectURL(b))}catch(a){console.error("Error:",a),alert("Error al procesar la imagen")}finally{i(!1)}}},t=async a=>{let{data:b,error:c}=await e.supabase.from("maquinas").select("id").eq("codigo",a).single();return null!==b},u=async b=>{if(b.preventDefault(),!n.codigo||!n.marca)return void alert("Por favor completa los campos requeridos");g(!0);try{if(await t(n.codigo)){alert(`âŒ El c\xf3digo "${n.codigo}" ya est\xe1 en uso.

Por favor usa un c\xf3digo diferente.`),g(!1);return}let{data:b,error:c}=await e.supabase.from("maquinas").insert([{codigo:n.codigo,marca:n.marca,modelo:n.modelo,cliente_id:n.cliente_id||null,descripcion:n.descripcion,estado:n.estado,foto_url:n.foto_url||null}]).select();if(c){console.error("Error al crear mÃ¡quina:",c),c.message.includes("duplicate key")?alert("âŒ El cÃ³digo ya existe. Por favor usa uno diferente."):c.message.includes("foreign key")?alert("âŒ El cliente seleccionado no existe."):alert("âŒ Error al crear la mÃ¡quina: "+c.message);return}console.log("MÃ¡quina creada:",b),alert("âœ… Â¡MÃ¡quina creada exitosamente!"),a.push("/admin/maquinas")}catch(a){console.error("Error:",a),alert("âŒ Error al guardar la mÃ¡quina")}finally{g(!1)}};return(0,b.jsxs)("div",{className:"p-6 max-w-2xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Nueva MÃ¡quina"}),(0,b.jsxs)("form",{onSubmit:u,className:"bg-white rounded-lg shadow-sm border p-6 space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Foto de la mÃ¡quina"}),j||n.foto_url?(0,b.jsxs)("div",{className:"relative inline-block",children:[(0,b.jsx)("img",{src:j||n.foto_url,alt:"Preview",className:"w-48 h-48 object-cover rounded-lg border-2 border-gray-300"}),(0,b.jsx)("button",{type:"button",onClick:()=>{o(a=>({...a,foto_url:""})),k(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600 shadow-lg",children:"âœ•"})]}):(0,b.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:s,disabled:h,className:"hidden",id:"file-upload"}),(0,b.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer",children:h?(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Subiendo imagen..."})]}):(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("svg",{className:"w-12 h-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,b.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Haz clic para subir una imagen"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG hasta 5MB"})]})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["CÃ³digo ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",name:"codigo",value:n.codigo,onChange:r,required:!0,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: MAQ-001"}),(0,b.jsx)("button",{type:"button",onClick:q,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-lg font-medium text-sm transition-colors whitespace-nowrap",title:"Generar cÃ³digo automÃ¡tico",children:"ðŸ”„ Auto"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:'El cÃ³digo debe ser Ãºnico. Usa el botÃ³n "Auto" para generar uno automÃ¡ticamente.'})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Marca ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"text",name:"marca",value:n.marca,onChange:r,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Caterpillar"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Modelo"}),(0,b.jsx)("input",{type:"text",name:"modelo",value:n.modelo,onChange:r,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: 320D"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Cliente"}),(0,b.jsxs)("select",{name:"cliente_id",value:n.cliente_id,onChange:r,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",children:[(0,b.jsx)("option",{value:"",children:"Seleccionar cliente (opcional)"}),l.map(a=>(0,b.jsx)("option",{value:a.id,children:a.nombre},a.id))]}),0===l.length&&(0,b.jsxs)("p",{className:"text-xs text-amber-600 mt-1",children:["âš ï¸ No hay clientes registrados.",(0,b.jsx)("a",{href:"/admin/clientes/crear",className:"underline ml-1",children:"Crear uno aquÃ­"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"DescripciÃ³n"}),(0,b.jsx)("textarea",{name:"descripcion",value:n.descripcion,onChange:r,rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe las caracterÃ­sticas de la mÃ¡quina..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Estado"}),(0,b.jsxs)("select",{name:"estado",value:n.estado,onChange:r,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,b.jsx)("option",{value:"operativo",children:"Operativo"}),(0,b.jsx)("option",{value:"en mantenimiento",children:"En Mantenimiento"}),(0,b.jsx)("option",{value:"fuera de servicio",children:"Fuera de Servicio"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,b.jsx)("button",{type:"submit",disabled:f||h,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:f?"Guardando...":"Guardar MÃ¡quina"}),(0,b.jsx)("button",{type:"button",onClick:()=>a.back(),disabled:f,className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})]})}a.s(["default",()=>f])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9341d1f8._.js.map