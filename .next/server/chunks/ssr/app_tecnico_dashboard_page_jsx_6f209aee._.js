module.exports=[18071,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(966),e=a.i(50944);function f(){let[a,f]=(0,c.useState)([]),[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)({maquina:null,cliente:null}),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1),t=(0,e.useRouter)();async function u(){try{let{data:{session:a},error:b}=await d.supabase.auth.getSession();if(b||!a)return void t.push("/login");m(a.user),await v(a.user)}catch(a){console.error("Error:",a),q("Error al cargar datos")}finally{o(!1)}}async function v(a){try{console.time("â±ï¸ Tiempo de carga");let{data:b}=await d.supabase.from("usuarios").select("*").eq("email",a.email).eq("rol","tecnico").maybeSingle(),c=b?.id||a.id;b&&console.log("âœ… TÃ©cnico encontrado:",b.nombre);let{data:e,error:g}=await d.supabase.from("ordenes").select(`
          *,
          maquinas:maquina_id (
            *,
            clientes:cliente_id (*)
          )
        `).eq("tecnico_id",c).in("estado",["asignada","en_progreso"]).order("created_at",{ascending:!1}).limit(50);if(g)throw g;console.log(`ðŸ“‹ ${e?.length||0} \xf3rdenes activas encontradas`),console.timeEnd("â±ï¸ Tiempo de carga"),f(e||[])}catch(a){console.error("Error al cargar Ã³rdenes:",a),q("Error al cargar Ã³rdenes: "+a.message)}}async function w(a){i(a),k({maquina:a.maquinas||null,cliente:a.maquinas?.clientes||null}),setTimeout(()=>{document.getElementById("detalles-orden")?.scrollIntoView({behavior:"smooth",block:"start"})},100)}async function x(){if(!h||!l)return void alert("Selecciona una orden primero");if("asignada"!==h.estado)return void alert("Esta orden ya fue iniciada o completada");s(!0);try{let a=new Date().toISOString(),{error:b}=await d.supabase.from("ordenes").update({estado:"en_progreso",fecha_inicio:a}).eq("id",h.id);if(b)throw b;let{error:c}=await d.supabase.from("historial").insert({orden_id:h.id,tecnico_id:l.id,accion:"iniciar_trabajo",detalles:`Trabajo iniciado el ${new Date().toLocaleString("es-ES")}`,fecha:a});c&&console.warn("âš ï¸ No se pudo crear historial:",c),f(b=>b.map(b=>b.id===h.id?{...b,estado:"en_progreso",fecha_inicio:a}:b)),i(b=>({...b,estado:"en_progreso",fecha_inicio:a})),alert("âœ… Â¡Trabajo iniciado correctamente!\n\nPuedes empezar a trabajar en la orden."),t.push(`/tecnico/trabajo-actual?orden=${h.id}`)}catch(a){console.error("âŒ Error al iniciar trabajo:",a),alert("âŒ Error al iniciar trabajo: "+a.message)}finally{s(!1)}}async function y(){await d.supabase.auth.signOut(),t.push("/login")}if((0,c.useEffect)(()=>{u()},[]),(0,c.useEffect)(()=>{if(l){let a=d.supabase.channel("ordenes-tecnico").on("postgres_changes",{event:"INSERT",schema:"public",table:"ordenes",filter:`tecnico_id=eq.${l.id}`},a=>{console.log("ðŸ†• Nueva orden asignada:",a.new),f(b=>[a.new,...b]),alert("ðŸŽ¯ Â¡Tienes una nueva orden asignada!")}).subscribe();return()=>d.supabase.removeChannel(a)}},[l]),n)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Cargando panel del tÃ©cnico..."})]})});if(p)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded max-w-md",children:[(0,b.jsx)("p",{className:"font-bold",children:"Error"}),(0,b.jsx)("p",{children:p}),(0,b.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reintentar"})]})});let z=a.filter(a=>"asignada"===a.estado),A=a.filter(a=>"en_progreso"===a.estado);return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ”§ Panel del TÃ©cnico"}),(0,b.jsx)("p",{className:"text-gray-600",children:l?.email})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"ðŸ”„ Actualizar"}),(0,b.jsx)("button",{onClick:()=>t.push("/tecnico/historial"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"ðŸ“š Historial"}),(0,b.jsx)("button",{onClick:y,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Cerrar SesiÃ³n"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded shadow",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Pendientes"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-yellow-700",children:z.length})]}),(0,b.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded shadow",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"En Progreso"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-blue-700",children:A.length})]})]}),0===a.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,b.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),(0,b.jsx)("h2",{className:"text-xl font-bold mb-2",children:"No tienes Ã³rdenes activas"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Las nuevas Ã³rdenes aparecerÃ¡n aquÃ­ automÃ¡ticamente."}),(0,b.jsx)("button",{onClick:()=>t.push("/tecnico/historial"),className:"mt-4 px-6 py-3 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"ðŸ“š Ver Historial de Trabajos"})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[z.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-xl font-bold mb-3 flex items-center gap-2",children:["âš ï¸ Ã“rdenes Pendientes",(0,b.jsx)("span",{className:"bg-yellow-500 text-white text-sm px-2 py-1 rounded-full",children:z.length})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.map(a=>(0,b.jsx)(g,{orden:a,onVerDetalles:w,seleccionada:h?.id===a.id},a.id))})]}),A.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-xl font-bold mb-3 flex items-center gap-2",children:["ðŸ”„ En Progreso",(0,b.jsx)("span",{className:"bg-blue-500 text-white text-sm px-2 py-1 rounded-full",children:A.length})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(a=>(0,b.jsx)(g,{orden:a,onVerDetalles:w,seleccionada:h?.id===a.id},a.id))})]})]}),h&&(0,b.jsxs)("div",{id:"detalles-orden",className:"mt-8 space-y-6",children:[(0,b.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-lg shadow-lg",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"ðŸ“‹ Detalles de la Orden"}),(0,b.jsxs)("p",{className:"opacity-90",children:["ID: #",h.id]})]}),(0,b.jsx)("button",{onClick:()=>i(null),className:"bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded transition",children:"âœ• Cerrar"})]})}),(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-bold",children:"InformaciÃ³n del Trabajo"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Creada: ",new Date(h.created_at).toLocaleString("es-ES")]})]}),(0,b.jsx)("span",{className:`px-4 py-2 rounded-full text-sm font-medium ${"urgente"===h.prioridad?"bg-red-100 text-red-800":"alta"===h.prioridad?"bg-orange-100 text-orange-800":"media"===h.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:h.prioridad})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Tipo de Trabajo"}),(0,b.jsx)("p",{className:"font-medium capitalize",children:h.tipo})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,b.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${"asignada"===h.estado?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:"asignada"===h.estado?"Pendiente":"En Progreso"})]})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"ðŸ“ DescripciÃ³n"}),(0,b.jsx)("div",{className:"bg-yellow-50 p-4 rounded border-l-4 border-yellow-400",children:(0,b.jsx)("p",{className:"text-gray-800",children:h.descripcion||"Sin descripciÃ³n"})})]}),(0,b.jsxs)("div",{className:"flex gap-3 mt-6",children:["asignada"===h.estado&&(0,b.jsx)("button",{onClick:x,disabled:r,className:"flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-bold shadow-lg hover:shadow-xl disabled:bg-gray-400",children:r?"â³ Iniciando...":"ðŸš€ Iniciar Trabajo"}),"en_progreso"===h.estado&&(0,b.jsx)("button",{onClick:()=>t.push(`/tecnico/trabajo-actual?orden=${h.id}`),className:"flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-bold shadow-lg hover:shadow-xl",children:"â–¶ï¸ Continuar Trabajo"})]})]}),j.cliente&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,b.jsx)("h3",{className:"font-bold text-lg mb-4",children:"ðŸ‘¤ InformaciÃ³n del Cliente"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Nombre"}),(0,b.jsx)("p",{className:"font-medium",children:j.cliente.nombre})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"RUC"}),(0,b.jsx)("p",{className:"font-medium",children:j.cliente.ruc||"N/A"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"TelÃ©fono"}),(0,b.jsx)("p",{className:"font-medium",children:j.cliente.telefono||"N/A"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Email"}),(0,b.jsx)("p",{className:"font-medium",children:j.cliente.email||"N/A"})]})]})]}),j.maquina&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,b.jsx)("h3",{className:"font-bold text-lg mb-4",children:"ðŸšœ Perfil de la MÃ¡quina"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[j.maquina.foto_url&&(0,b.jsx)("div",{className:"md:col-span-1",children:(0,b.jsx)("img",{src:j.maquina.foto_url,alt:j.maquina.codigo,className:"w-full h-48 object-cover rounded-lg shadow"})}),(0,b.jsx)("div",{className:j.maquina.foto_url?"md:col-span-2":"md:col-span-3",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"bg-blue-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"CÃ³digo"}),(0,b.jsx)("p",{className:"font-bold text-lg",children:j.maquina.codigo})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,b.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${"operativa"===j.maquina.estado?"bg-green-100 text-green-800":"mantenimiento"===j.maquina.estado?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:j.maquina.estado})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Marca"}),(0,b.jsx)("p",{className:"font-medium",children:j.maquina.marca||"N/A"})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Modelo"}),(0,b.jsx)("p",{className:"font-medium",children:j.maquina.modelo||"N/A"})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Serie"}),(0,b.jsx)("p",{className:"font-medium",children:j.maquina.serie||"N/A"})]}),(0,b.jsxs)("div",{className:"bg-green-50 p-3 rounded",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"HorÃ³metro"}),(0,b.jsxs)("p",{className:"font-bold text-green-700",children:[j.maquina.horometro||0," hrs"]})]})]})})]})]})]})]})})}function g({orden:a,onVerDetalles:c,seleccionada:d}){let e={asignada:{bg:"bg-yellow-50",border:"border-yellow-300",text:"text-yellow-800",badge:"bg-yellow-500"},en_progreso:{bg:"bg-blue-50",border:"border-blue-300",text:"text-blue-800",badge:"bg-blue-500"}},f=e[a.estado]||e.asignada;return(0,b.jsxs)("div",{className:`${f.bg} border-2 ${d?"border-blue-500":f.border} rounded-lg p-4 hover:shadow-lg transition cursor-pointer`,onClick:()=>c(a),children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Orden #",a.id]}),(0,b.jsx)("h3",{className:"font-bold text-lg capitalize",children:a.tipo})]}),(0,b.jsx)("span",{className:`${f.badge} text-white text-xs px-2 py-1 rounded-full`,children:a.prioridad})]}),(0,b.jsx)("p",{className:"text-sm text-gray-700 mb-3 line-clamp-2",children:a.descripcion||"Sin descripciÃ³n"}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:`text-xs font-medium ${f.text}`,children:"asignada"===a.estado?"â³ Pendiente":"ðŸ”„ En Progreso"}),(0,b.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition",onClick:b=>{b.stopPropagation(),c(a)},children:"Ver Detalles â†’"})]})]})}a.s(["default",()=>f])}];

//# sourceMappingURL=app_tecnico_dashboard_page_jsx_6f209aee._.js.map