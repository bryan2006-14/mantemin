module.exports=[20613,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(966),e=a.i(50944);function f(){let a,f,g,h,i,[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)("todos"),[r,s]=(0,c.useState)("todos"),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(null),x=(0,e.useRouter)();async function y(){try{let{data:a}=await d.supabase.from("usuarios").select("id, nombre, email").eq("rol","tecnico").order("nombre");m(a||[]);let b=d.supabase.from("ordenes").select(`
          *,
          maquinas:maquina_id (
            codigo,
            marca,
            modelo,
            clientes:cliente_id (
              nombre
            )
          )
        `).eq("estado","completada").order("fecha_fin",{ascending:!1});if("todos"!==p&&(b=b.eq("tecnico_id",p)),"ultima_semana"===r){let a=new Date;a.setDate(a.getDate()-7),b=b.gte("fecha_fin",a.toISOString())}else if("ultimo_mes"===r){let a=new Date;a.setDate(a.getDate()-30),b=b.gte("fecha_fin",a.toISOString())}else if("ultimo_trimestre"===r){let a=new Date;a.setDate(a.getDate()-90),b=b.gte("fecha_fin",a.toISOString())}let{data:c,error:e}=await b;if(e)throw e;let f=await Promise.all((c||[]).map(async a=>{let{data:b}=await d.supabase.from("usuarios").select("nombre, email").eq("id",a.tecnico_id).maybeSingle();return{...a,tecnico_nombre:b?.nombre||"Sin asignar"}}));console.log(`ðŸ“š ${f?.length||0} trabajos completados`),k(f)}catch(a){console.error("Error al cargar historial:",a),alert("Error al cargar historial: "+a.message)}finally{o(!1)}}function z(a,b){if(!a||!b)return"N/A";let c=new Date(a),d=new Date(b)-c,e=Math.floor(d/36e5),f=Math.floor(d%36e5/6e4);if(e>24){let a=Math.floor(e/24);return`${a}d ${e%24}h`}return`${e}h ${f}m`}if((0,c.useEffect)(()=>{y()},[p,r]),n)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Cargando historial..."})]})});let A=(f=(a=j.filter(a=>""===t||a.maquinas?.codigo?.toLowerCase().includes(t.toLowerCase())||a.maquinas?.clientes?.nombre?.toLowerCase().includes(t.toLowerCase())||a.tecnico_nombre?.toLowerCase().includes(t.toLowerCase()))).length,g=0,a.forEach(a=>{if(a.fecha_inicio&&a.fecha_fin){let b=new Date(a.fecha_inicio),c=new Date(a.fecha_fin);g+=c-b}}),h=Math.floor(g/36e5),i=f>0?Math.round(h/f):0,{total:f,tiempoTotalHoras:h,promedioHoras:i,porTipo:a.reduce((a,b)=>(a[b.tipo]=(a[b.tipo]||0)+1,a),{})}),B=j.filter(a=>""===t||a.maquinas?.codigo?.toLowerCase().includes(t.toLowerCase())||a.maquinas?.clientes?.nombre?.toLowerCase().includes(t.toLowerCase())||a.tecnico_nombre?.toLowerCase().includes(t.toLowerCase()));return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ“š Historial de Trabajos"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Registro completo de mantenimientos realizados"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:function(){let a=new Blob([[["Fecha","TÃ©cnico","MÃ¡quina","Cliente","Tipo","Prioridad","DuraciÃ³n","Estado"],...j.map(a=>[new Date(a.fecha_fin).toLocaleDateString("es-ES"),a.tecnico_nombre,a.maquinas?.codigo||"N/A",a.maquinas?.clientes?.nombre||"N/A",a.tipo,a.prioridad,z(a.fecha_inicio,a.fecha_fin),a.estado])].map(a=>a.join(",")).join("\n")],{type:"text/csv"}),b=window.URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`historial_${new Date().toISOString().split("T")[0]}.csv`,c.click()},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:"ðŸ“¥ Exportar CSV"}),(0,b.jsx)("button",{onClick:()=>x.push("/admin"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"â† Volver"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,b.jsx)("p",{className:"text-gray-600 mb-2",children:"Total Trabajos"}),(0,b.jsx)("p",{className:"text-4xl font-bold text-blue-600",children:A.total})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,b.jsx)("p",{className:"text-gray-600 mb-2",children:"Tiempo Total"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:[A.tiempoTotalHoras,"h"]})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,b.jsx)("p",{className:"text-gray-600 mb-2",children:"Promedio"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-purple-600",children:[A.promedioHoras,"h"]})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,b.jsx)("p",{className:"text-gray-600 mb-2 text-sm",children:"Por Tipo"}),(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,b.jsxs)("p",{children:["Preventivo: ",(0,b.jsx)("strong",{children:A.porTipo.preventivo||0})]}),(0,b.jsxs)("p",{children:["Correctivo: ",(0,b.jsx)("strong",{children:A.porTipo.correctivo||0})]}),(0,b.jsxs)("p",{children:["Emergencia: ",(0,b.jsx)("strong",{children:A.porTipo.emergencia||0})]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Buscar"}),(0,b.jsx)("input",{type:"text",placeholder:"MÃ¡quina, cliente o tÃ©cnico...",value:t,onChange:a=>u(a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"TÃ©cnico"}),(0,b.jsxs)("select",{value:p,onChange:a=>q(a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,b.jsx)("option",{value:"todos",children:"Todos los tÃ©cnicos"}),l.map(a=>(0,b.jsx)("option",{value:a.id,children:a.nombre},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"PerÃ­odo"}),(0,b.jsxs)("select",{value:r,onChange:a=>s(a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,b.jsx)("option",{value:"todos",children:"Todos los perÃ­odos"}),(0,b.jsx)("option",{value:"ultima_semana",children:"Ãšltima Semana"}),(0,b.jsx)("option",{value:"ultimo_mes",children:"Ãšltimo Mes"}),(0,b.jsx)("option",{value:"ultimo_trimestre",children:"Ãšltimo Trimestre"})]})]})]}),t&&(0,b.jsxs)("p",{className:"mt-3 text-sm text-gray-600",children:["Mostrando ",B.length," de ",j.length," resultados"]})]}),0===B.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,b.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),(0,b.jsx)("h2",{className:"text-xl font-bold mb-2",children:"No se encontraron trabajos"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Los trabajos finalizados aparecerÃ¡n aquÃ­."})]}):(0,b.jsx)("div",{className:"space-y-4",children:B.map(a=>(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6 cursor-pointer",onClick:()=>w(a),children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsxs)("h3",{className:"font-bold text-lg",children:["Orden #",a.id]}),(0,b.jsx)("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full",children:"Completada"}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${"urgente"===a.prioridad?"bg-red-100 text-red-800":"alta"===a.prioridad?"bg-orange-100 text-orange-800":"media"===a.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:a.prioridad})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 capitalize",children:[a.tipo," - ",a.maquinas?.codigo," (",a.maquinas?.marca,")"]}),a.maquinas?.clientes?.nombre&&(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Cliente: ",a.maquinas.clientes.nombre]}),(0,b.jsxs)("p",{className:"text-sm text-blue-600 font-medium mt-1",children:["ðŸ‘¤ ",a.tecnico_nombre]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Finalizado"}),(0,b.jsx)("p",{className:"font-medium",children:new Date(a.fecha_fin).toLocaleDateString("es-ES")}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:new Date(a.fecha_fin).toLocaleTimeString("es-ES")})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[(0,b.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600",children:"DuraciÃ³n"}),(0,b.jsx)("p",{className:"font-medium text-sm",children:z(a.fecha_inicio,a.fecha_fin)})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600",children:"Iniciado"}),(0,b.jsx)("p",{className:"font-medium text-sm",children:new Date(a.fecha_inicio).toLocaleDateString("es-ES")})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600",children:"Completado"}),(0,b.jsx)("p",{className:"font-medium text-sm",children:new Date(a.fecha_fin).toLocaleDateString("es-ES")})]})]}),a.observaciones&&(0,b.jsxs)("div",{className:"bg-blue-50 p-3 rounded border-l-4 border-blue-400",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Observaciones:"}),(0,b.jsx)("p",{className:"text-sm text-gray-800 line-clamp-2",children:a.observaciones})]}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),w(a)},className:"mt-3 text-blue-600 text-sm hover:underline",children:"Ver detalles completos â†’"})]},a.id))}),v&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>w(null),children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white p-6",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-2xl font-bold mb-1",children:["Orden #",v.id]}),(0,b.jsx)("p",{className:"opacity-90",children:"Trabajo Completado"}),(0,b.jsxs)("p",{className:"text-sm opacity-75 mt-1",children:["ðŸ‘¤ TÃ©cnico: ",v.tecnico_nombre]})]}),(0,b.jsx)("button",{onClick:()=>w(null),className:"bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded transition",children:"âœ•"})]})}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ“ DescripciÃ³n"}),(0,b.jsx)("p",{className:"text-gray-700 bg-gray-50 p-3 rounded",children:v.descripcion||"Sin descripciÃ³n"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Tipo"}),(0,b.jsx)("p",{className:"font-medium capitalize",children:v.tipo})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Prioridad"}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"urgente"===v.prioridad?"bg-red-100 text-red-800":"alta"===v.prioridad?"bg-orange-100 text-orange-800":"media"===v.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:v.prioridad})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"DuraciÃ³n Total"}),(0,b.jsx)("p",{className:"font-medium",children:z(v.fecha_inicio,v.fecha_fin)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,b.jsx)("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:"Completada"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ”§ InformaciÃ³n de MÃ¡quina"}),(0,b.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"CÃ³digo:"})," ",v.maquinas?.codigo||"N/A"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Marca:"})," ",v.maquinas?.marca||"N/A"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Modelo:"})," ",v.maquinas?.modelo||"N/A"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Cliente:"})," ",v.maquinas?.clientes?.nombre||"N/A"]})]})]}),v.observaciones&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ“‹ Observaciones / Trabajo Realizado"}),(0,b.jsx)("div",{className:"bg-blue-50 p-4 rounded border-l-4 border-blue-400",children:(0,b.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap",children:v.observaciones})})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,b.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ• LÃ­nea de Tiempo"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Creada:"}),(0,b.jsx)("span",{className:"font-medium",children:new Date(v.created_at).toLocaleString("es-ES")})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Iniciada:"}),(0,b.jsx)("span",{className:"font-medium",children:new Date(v.fecha_inicio).toLocaleString("es-ES")})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Finalizada:"}),(0,b.jsx)("span",{className:"font-medium text-green-700",children:new Date(v.fecha_fin).toLocaleString("es-ES")})]})]})]})]})]})})]})})}a.s(["default",()=>f])}];

//# sourceMappingURL=app_admin_historial_page_jsx_88823253._.js.map