(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,a)=>{s.exports=e.r(76562)},47980,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(33726),l=e.i(18566);function i(){let[e,i]=(0,a.useState)([]),[r,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[o,x]=(0,a.useState)(null),m=(0,l.useRouter)();async function h(){try{let{data:{session:e}}=await t.supabase.auth.getSession();if(!e)return void m.push("/login");n(e.user);let{data:s}=await t.supabase.from("usuarios").select("*").eq("email",e.user.email).eq("rol","tecnico").maybeSingle(),a=s?.id||e.user.id,{data:l,error:r}=await t.supabase.from("ordenes").select(`
          *,
          maquinas:maquina_id (
            codigo,
            marca,
            modelo,
            clientes:cliente_id (
              nombre
            )
          )
        `).eq("tecnico_id",a).eq("estado","completada").order("fecha_fin",{ascending:!1});if(r)throw r;console.log(`ðŸ“š ${l?.length||0} trabajos completados`),i(l||[])}catch(e){console.error("Error:",e),alert("Error al cargar historial: "+e.message)}finally{c(!1)}}function p(e,s){if(!e||!s)return"N/A";let a=new Date(e),t=new Date(s)-a,l=Math.floor(t/36e5),i=Math.floor(t%36e5/6e4);if(l>24){let e=Math.floor(l/24);return`${e}d ${l%24}h`}return`${l}h ${i}m`}return((0,a.useEffect)(()=>{h()},[]),d)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Cargando historial..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ“š Historial de Trabajos"}),(0,s.jsx)("p",{className:"text-gray-600",children:r?.email})]}),(0,s.jsx)("div",{className:"flex gap-3",children:(0,s.jsx)("button",{onClick:()=>m.push("/tecnico/dashboard"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"â† Volver al Panel"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded shadow",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Trabajos Completados"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-700",children:e.length})]}),(0,s.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded shadow",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Este Mes"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-blue-700",children:e.filter(e=>{let s=new Date(e.fecha_fin),a=new Date;return s.getMonth()===a.getMonth()&&s.getFullYear()===a.getFullYear()}).length})]}),(0,s.jsxs)("div",{className:"bg-purple-50 border-l-4 border-purple-500 p-4 rounded shadow",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Hoy"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-purple-700",children:e.filter(e=>{let s=new Date(e.fecha_fin),a=new Date;return s.toDateString()===a.toDateString()}).length})]})]}),0===e.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),(0,s.jsx)("h2",{className:"text-xl font-bold mb-2",children:"No hay trabajos completados"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Los trabajos finalizados aparecerÃ¡n aquÃ­."})]}):(0,s.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6 cursor-pointer",onClick:()=>x(e),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsxs)("h3",{className:"font-bold text-lg",children:["Orden #",e.id]}),(0,s.jsx)("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full",children:"Completada"}),(0,s.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${"urgente"===e.prioridad?"bg-red-100 text-red-800":"alta"===e.prioridad?"bg-orange-100 text-orange-800":"media"===e.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:e.prioridad})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 capitalize",children:[e.tipo," - ",e.maquinas?.codigo," (",e.maquinas?.marca,")"]}),e.maquinas?.clientes?.nombre&&(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Cliente: ",e.maquinas.clientes.nombre]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Finalizado"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(e.fecha_fin).toLocaleDateString("es-ES")}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.fecha_fin).toLocaleTimeString("es-ES")})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"DuraciÃ³n"}),(0,s.jsx)("p",{className:"font-medium text-sm",children:p(e.fecha_inicio,e.fecha_fin)})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Iniciado"}),(0,s.jsx)("p",{className:"font-medium text-sm",children:new Date(e.fecha_inicio).toLocaleDateString("es-ES")})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Completado"}),(0,s.jsx)("p",{className:"font-medium text-sm",children:new Date(e.fecha_fin).toLocaleDateString("es-ES")})]})]}),e.observaciones&&(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded border-l-4 border-blue-400",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Observaciones:"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 line-clamp-2",children:e.observaciones})]}),(0,s.jsx)("button",{onClick:s=>{s.stopPropagation(),x(e)},className:"mt-3 text-blue-600 text-sm hover:underline",children:"Ver detalles completos â†’"})]},e.id))}),o&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>x(null),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white p-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold mb-1",children:["Orden #",o.id]}),(0,s.jsx)("p",{className:"opacity-90",children:"Trabajo Completado"})]}),(0,s.jsx)("button",{onClick:()=>x(null),className:"bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded transition",children:"âœ•"})]})}),(0,s.jsxs)("div",{className:"p-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ“ DescripciÃ³n"}),(0,s.jsx)("p",{className:"text-gray-700 bg-gray-50 p-3 rounded",children:o.descripcion||"Sin descripciÃ³n"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Tipo"}),(0,s.jsx)("p",{className:"font-medium capitalize",children:o.tipo})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Prioridad"}),(0,s.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"urgente"===o.prioridad?"bg-red-100 text-red-800":"alta"===o.prioridad?"bg-orange-100 text-orange-800":"media"===o.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:o.prioridad})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"DuraciÃ³n Total"}),(0,s.jsx)("p",{className:"font-medium",children:p(o.fecha_inicio,o.fecha_fin)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,s.jsx)("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:"Completada"})]})]}),o.observaciones&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ“‹ Observaciones / Trabajo Realizado"}),(0,s.jsx)("div",{className:"bg-blue-50 p-4 rounded border-l-4 border-blue-400",children:(0,s.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap",children:o.observaciones})})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ• LÃ­nea de Tiempo"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Creada:"}),(0,s.jsx)("span",{className:"font-medium",children:new Date(o.created_at).toLocaleString("es-ES")})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Iniciada:"}),(0,s.jsx)("span",{className:"font-medium",children:new Date(o.fecha_inicio).toLocaleString("es-ES")})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Finalizada:"}),(0,s.jsx)("span",{className:"font-medium text-green-700",children:new Date(o.fecha_fin).toLocaleString("es-ES")})]})]})]})]})]})})]})})}e.s(["default",()=>i])}]);