(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,a)=>{s.exports=e.r(76562)},37406,e=>{"use strict";var s=e.i(43476),a=e.i(71645),r=e.i(33726),l=e.i(18566);function t(){let[e,t]=(0,a.useState)([]),[n,d]=(0,a.useState)(null),[o,c]=(0,a.useState)({maquina:null,cliente:null}),[m,x]=(0,a.useState)(null),[g,h]=(0,a.useState)(!0),[u,b]=(0,a.useState)(""),[p,j]=(0,a.useState)(!1),N=(0,l.useRouter)();async function f(){try{let{data:{session:e},error:s}=await r.supabase.auth.getSession();if(s||!e)return void N.push("/login");x(e.user),await y(e.user)}catch(e){console.error("Error:",e),b("Error al cargar datos")}finally{h(!1)}}async function y(e){try{console.time("â±ï¸ Tiempo de carga");let{data:s}=await r.supabase.from("usuarios").select("*").eq("email",e.email).eq("rol","tecnico").maybeSingle(),a=s?.id||e.id;s&&console.log("âœ… TÃ©cnico encontrado:",s.nombre);let{data:l,error:i}=await r.supabase.from("ordenes").select(`
          *,
          maquinas:maquina_id (
            *,
            clientes:cliente_id (*)
          )
        `).eq("tecnico_id",a).in("estado",["asignada","en_progreso"]).order("created_at",{ascending:!1}).limit(50);if(i)throw i;console.log(`ðŸ“‹ ${l?.length||0} \xf3rdenes activas encontradas`),console.timeEnd("â±ï¸ Tiempo de carga"),t(l||[])}catch(e){console.error("Error al cargar Ã³rdenes:",e),b("Error al cargar Ã³rdenes: "+e.message)}}async function v(e){d(e),c({maquina:e.maquinas||null,cliente:e.maquinas?.clientes||null}),setTimeout(()=>{document.getElementById("detalles-orden")?.scrollIntoView({behavior:"smooth",block:"start"})},100)}async function w(){if(!n||!m)return void alert("Selecciona una orden primero");if("asignada"!==n.estado)return void alert("Esta orden ya fue iniciada o completada");j(!0);try{let e=new Date().toISOString(),{error:s}=await r.supabase.from("ordenes").update({estado:"en_progreso",fecha_inicio:e}).eq("id",n.id);if(s)throw s;let{error:a}=await r.supabase.from("historial").insert({orden_id:n.id,tecnico_id:m.id,accion:"iniciar_trabajo",detalles:`Trabajo iniciado el ${new Date().toLocaleString("es-ES")}`,fecha:e});a&&console.warn("âš ï¸ No se pudo crear historial:",a),t(s=>s.map(s=>s.id===n.id?{...s,estado:"en_progreso",fecha_inicio:e}:s)),d(s=>({...s,estado:"en_progreso",fecha_inicio:e})),alert("âœ… Â¡Trabajo iniciado correctamente!\n\nPuedes empezar a trabajar en la orden."),N.push(`/tecnico/trabajo-actual?orden=${n.id}`)}catch(e){console.error("âŒ Error al iniciar trabajo:",e),alert("âŒ Error al iniciar trabajo: "+e.message)}finally{j(!1)}}async function q(){await r.supabase.auth.signOut(),N.push("/login")}if((0,a.useEffect)(()=>{f()},[]),(0,a.useEffect)(()=>{if(m){let e=r.supabase.channel("ordenes-tecnico").on("postgres_changes",{event:"INSERT",schema:"public",table:"ordenes",filter:`tecnico_id=eq.${m.id}`},e=>{console.log("ðŸ†• Nueva orden asignada:",e.new),t(s=>[e.new,...s]),alert("ðŸŽ¯ Â¡Tienes una nueva orden asignada!")}).subscribe();return()=>r.supabase.removeChannel(e)}},[m]),g)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Cargando panel del tÃ©cnico..."})]})});if(u)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded max-w-md",children:[(0,s.jsx)("p",{className:"font-bold",children:"Error"}),(0,s.jsx)("p",{children:u}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reintentar"})]})});let _=e.filter(e=>"asignada"===e.estado),E=e.filter(e=>"en_progreso"===e.estado);return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ”§ Panel del TÃ©cnico"}),(0,s.jsx)("p",{className:"text-gray-600",children:m?.email})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"ðŸ”„ Actualizar"}),(0,s.jsx)("button",{onClick:()=>N.push("/tecnico/historial"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"ðŸ“š Historial"}),(0,s.jsx)("button",{onClick:q,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Cerrar SesiÃ³n"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded shadow",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Pendientes"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-yellow-700",children:_.length})]}),(0,s.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded shadow",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"En Progreso"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-blue-700",children:E.length})]})]}),0===e.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),(0,s.jsx)("h2",{className:"text-xl font-bold mb-2",children:"No tienes Ã³rdenes activas"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Las nuevas Ã³rdenes aparecerÃ¡n aquÃ­ automÃ¡ticamente."}),(0,s.jsx)("button",{onClick:()=>N.push("/tecnico/historial"),className:"mt-4 px-6 py-3 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"ðŸ“š Ver Historial de Trabajos"})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[_.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-3 flex items-center gap-2",children:["âš ï¸ Ã“rdenes Pendientes",(0,s.jsx)("span",{className:"bg-yellow-500 text-white text-sm px-2 py-1 rounded-full",children:_.length})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map(e=>(0,s.jsx)(i,{orden:e,onVerDetalles:v,seleccionada:n?.id===e.id},e.id))})]}),E.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-3 flex items-center gap-2",children:["ðŸ”„ En Progreso",(0,s.jsx)("span",{className:"bg-blue-500 text-white text-sm px-2 py-1 rounded-full",children:E.length})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(e=>(0,s.jsx)(i,{orden:e,onVerDetalles:v,seleccionada:n?.id===e.id},e.id))})]})]}),n&&(0,s.jsxs)("div",{id:"detalles-orden",className:"mt-8 space-y-6",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-lg shadow-lg",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"ðŸ“‹ Detalles de la Orden"}),(0,s.jsxs)("p",{className:"opacity-90",children:["ID: #",n.id]})]}),(0,s.jsx)("button",{onClick:()=>d(null),className:"bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded transition",children:"âœ• Cerrar"})]})}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold",children:"InformaciÃ³n del Trabajo"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Creada: ",new Date(n.created_at).toLocaleString("es-ES")]})]}),(0,s.jsx)("span",{className:`px-4 py-2 rounded-full text-sm font-medium ${"urgente"===n.prioridad?"bg-red-100 text-red-800":"alta"===n.prioridad?"bg-orange-100 text-orange-800":"media"===n.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:n.prioridad})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Tipo de Trabajo"}),(0,s.jsx)("p",{className:"font-medium capitalize",children:n.tipo})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,s.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${"asignada"===n.estado?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:"asignada"===n.estado?"Pendiente":"En Progreso"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"ðŸ“ DescripciÃ³n"}),(0,s.jsx)("div",{className:"bg-yellow-50 p-4 rounded border-l-4 border-yellow-400",children:(0,s.jsx)("p",{className:"text-gray-800",children:n.descripcion||"Sin descripciÃ³n"})})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-6",children:["asignada"===n.estado&&(0,s.jsx)("button",{onClick:w,disabled:p,className:"flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-bold shadow-lg hover:shadow-xl disabled:bg-gray-400",children:p?"â³ Iniciando...":"ðŸš€ Iniciar Trabajo"}),"en_progreso"===n.estado&&(0,s.jsx)("button",{onClick:()=>N.push(`/tecnico/trabajo-actual?orden=${n.id}`),className:"flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-bold shadow-lg hover:shadow-xl",children:"â–¶ï¸ Continuar Trabajo"})]})]}),o.cliente&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,s.jsx)("h3",{className:"font-bold text-lg mb-4",children:"ðŸ‘¤ InformaciÃ³n del Cliente"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Nombre"}),(0,s.jsx)("p",{className:"font-medium",children:o.cliente.nombre})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"RUC"}),(0,s.jsx)("p",{className:"font-medium",children:o.cliente.ruc||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"TelÃ©fono"}),(0,s.jsx)("p",{className:"font-medium",children:o.cliente.telefono||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Email"}),(0,s.jsx)("p",{className:"font-medium",children:o.cliente.email||"N/A"})]})]})]}),o.maquina&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,s.jsx)("h3",{className:"font-bold text-lg mb-4",children:"ðŸšœ Perfil de la MÃ¡quina"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.maquina.foto_url&&(0,s.jsx)("div",{className:"md:col-span-1",children:(0,s.jsx)("img",{src:o.maquina.foto_url,alt:o.maquina.codigo,className:"w-full h-48 object-cover rounded-lg shadow"})}),(0,s.jsx)("div",{className:o.maquina.foto_url?"md:col-span-2":"md:col-span-3",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"CÃ³digo"}),(0,s.jsx)("p",{className:"font-bold text-lg",children:o.maquina.codigo})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,s.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${"operativa"===o.maquina.estado?"bg-green-100 text-green-800":"mantenimiento"===o.maquina.estado?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:o.maquina.estado})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Marca"}),(0,s.jsx)("p",{className:"font-medium",children:o.maquina.marca||"N/A"})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Modelo"}),(0,s.jsx)("p",{className:"font-medium",children:o.maquina.modelo||"N/A"})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Serie"}),(0,s.jsx)("p",{className:"font-medium",children:o.maquina.serie||"N/A"})]}),(0,s.jsxs)("div",{className:"bg-green-50 p-3 rounded",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"HorÃ³metro"}),(0,s.jsxs)("p",{className:"font-bold text-green-700",children:[o.maquina.horometro||0," hrs"]})]})]})})]})]})]})]})})}function i({orden:e,onVerDetalles:a,seleccionada:r}){let l={asignada:{bg:"bg-yellow-50",border:"border-yellow-300",text:"text-yellow-800",badge:"bg-yellow-500"},en_progreso:{bg:"bg-blue-50",border:"border-blue-300",text:"text-blue-800",badge:"bg-blue-500"}},t=l[e.estado]||l.asignada;return(0,s.jsxs)("div",{className:`${t.bg} border-2 ${r?"border-blue-500":t.border} rounded-lg p-4 hover:shadow-lg transition cursor-pointer`,onClick:()=>a(e),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Orden #",e.id]}),(0,s.jsx)("h3",{className:"font-bold text-lg capitalize",children:e.tipo})]}),(0,s.jsx)("span",{className:`${t.badge} text-white text-xs px-2 py-1 rounded-full`,children:e.prioridad})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-3 line-clamp-2",children:e.descripcion||"Sin descripciÃ³n"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:`text-xs font-medium ${t.text}`,children:"asignada"===e.estado?"â³ Pendiente":"ðŸ”„ En Progreso"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition",onClick:s=>{s.stopPropagation(),a(e)},children:"Ver Detalles â†’"})]})]})}e.s(["default",()=>t])}]);