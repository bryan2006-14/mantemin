(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,s)=>{t.exports=e.r(76562)},37144,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(33726),i=e.i(18566);function r(){let e,r,l,n,[o,c]=(0,s.useState)([]),[d,m]=(0,s.useState)([]),[x,u]=(0,s.useState)(!0),[h,p]=(0,s.useState)("todos"),[g,b]=(0,s.useState)("todos"),[j,N]=(0,s.useState)(""),f=(0,i.useRouter)();async function v(){try{let{data:e}=await a.supabase.from("usuarios").select("id, nombre, email").eq("rol","tecnico").order("nombre");m(e||[]);let t=a.supabase.from("historial_trabajos").select("*").order("created_at",{ascending:!1});if("todos"!==h&&(t=t.eq("tecnico_id",h)),"ultima_semana"===g){let e=new Date;e.setDate(e.getDate()-7),t=t.gte("created_at",e.toISOString())}else if("ultimo_mes"===g){let e=new Date;e.setDate(e.getDate()-30),t=t.gte("created_at",e.toISOString())}else if("ultimo_trimestre"===g){let e=new Date;e.setDate(e.getDate()-90),t=t.gte("created_at",e.toISOString())}let{data:s,error:i}=await t;if(i)throw i;let r=await Promise.all((s||[]).map(async e=>{let{data:t}=await a.supabase.from("usuarios").select("nombre, email").eq("id",e.tecnico_id).maybeSingle(),{data:s}=await a.supabase.from("maquinas").select("codigo, marca, modelo, foto_url, cliente_id").eq("id",e.maquina_id).maybeSingle(),i=null;if(s?.cliente_id){let{data:e}=await a.supabase.from("clientes").select("nombre").eq("id",s.cliente_id).maybeSingle();i=e}return{...e,tecnico:t,maquina:s?{...s,cliente:i}:null}}));c(r)}catch(e){console.error("Error al cargar historial:",e)}finally{u(!1)}}function w(e){if(!e)return"N/A";let t=Math.floor(e/60),s=e%60;return 0===t?`${s} min`:`${t}h ${s}min`}if((0,s.useEffect)(()=>{v()},[h,g]),x)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Cargando historial..."})]})});let y=(r=(e=o.filter(e=>""===j||e.maquina?.codigo?.toLowerCase().includes(j.toLowerCase())||e.maquina?.cliente?.nombre?.toLowerCase().includes(j.toLowerCase())||e.tecnico?.nombre?.toLowerCase().includes(j.toLowerCase()))).length,l=e.reduce((e,t)=>e+(t.duracion_minutos||0),0),n=r>0?Math.round(l/r):0,{total:r,tiempoTotal:l,promedio:n,porTipo:e.reduce((e,t)=>(e[t.tipo]=(e[t.tipo]||0)+1,e),{})}),S=o.filter(e=>""===j||e.maquina?.codigo?.toLowerCase().includes(j.toLowerCase())||e.maquina?.cliente?.nombre?.toLowerCase().includes(j.toLowerCase())||e.tecnico?.nombre?.toLowerCase().includes(j.toLowerCase()));return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"ðŸ“š Historial de Trabajos"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Registro completo de mantenimientos realizados"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:function(){let e=new Blob([[["Fecha","TÃ©cnico","MÃ¡quina","Cliente","Tipo","DuraciÃ³n (min)","Estado"],...o.map(e=>[new Date(e.created_at).toLocaleDateString("es-ES"),e.tecnico?.nombre||"N/A",e.maquina?.codigo||"N/A",e.maquina?.cliente?.nombre||"N/A",e.tipo,e.duracion_minutos||0,e.estado])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`historial_${new Date().toISOString().split("T")[0]}.csv`,s.click()},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"ðŸ“¥ Exportar CSV"}),(0,t.jsx)("button",{onClick:()=>f.push("/admin"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"â† Volver"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-2",children:"Total Trabajos"}),(0,t.jsx)("p",{className:"text-4xl font-bold text-blue-600",children:y.total})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-2",children:"Tiempo Total"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-green-600",children:w(y.tiempoTotal)})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-2",children:"Promedio"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-purple-600",children:w(y.promedio)})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-2 text-sm",children:"Por Tipo"}),(0,t.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,t.jsxs)("p",{children:["Preventivo: ",(0,t.jsx)("strong",{children:y.porTipo.preventivo||0})]}),(0,t.jsxs)("p",{children:["Correctivo: ",(0,t.jsx)("strong",{children:y.porTipo.correctivo||0})]}),(0,t.jsxs)("p",{children:["Emergencia: ",(0,t.jsx)("strong",{children:y.porTipo.emergencia||0})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Buscar"}),(0,t.jsx)("input",{type:"text",placeholder:"MÃ¡quina, cliente o tÃ©cnico...",value:j,onChange:e=>N(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"TÃ©cnico"}),(0,t.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,t.jsx)("option",{value:"todos",children:"Todos los tÃ©cnicos"}),d.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"PerÃ­odo"}),(0,t.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,t.jsx)("option",{value:"todos",children:"Todos los perÃ­odos"}),(0,t.jsx)("option",{value:"ultima_semana",children:"Ãšltima Semana"}),(0,t.jsx)("option",{value:"ultimo_mes",children:"Ãšltimo Mes"}),(0,t.jsx)("option",{value:"ultimo_trimestre",children:"Ãšltimo Trimestre"})]})]})]}),j&&(0,t.jsxs)("p",{className:"mt-3 text-sm text-gray-600",children:["Mostrando ",S.length," de ",o.length," resultados"]})]}),0===S.length?(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),(0,t.jsx)("p",{className:"text-gray-600 text-lg",children:"No se encontraron trabajos con los filtros aplicados"})]}):(0,t.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-200",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-3 text-left border",children:"Fecha"}),(0,t.jsx)("th",{className:"p-3 text-left border",children:"TÃ©cnico"}),(0,t.jsx)("th",{className:"p-3 text-left border",children:"MÃ¡quina/Cliente"}),(0,t.jsx)("th",{className:"p-3 text-left border",children:"Tipo"}),(0,t.jsx)("th",{className:"p-3 text-center border",children:"DuraciÃ³n"}),(0,t.jsx)("th",{className:"p-3 text-center border",children:"Evidencias"}),(0,t.jsx)("th",{className:"p-3 text-center border",children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:S.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 transition",children:[(0,t.jsx)("td",{className:"border p-3 text-sm",children:new Date(e.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})}),(0,t.jsxs)("td",{className:"border p-3",children:[(0,t.jsx)("p",{className:"font-medium",children:e.tecnico?.nombre||"N/A"}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:e.tecnico?.email})]}),(0,t.jsxs)("td",{className:"border p-3",children:[(0,t.jsx)("p",{className:"font-medium",children:e.maquina?.codigo||"N/A"}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:e.maquina?.cliente?.nombre||"Sin cliente"})]}),(0,t.jsx)("td",{className:"border p-3 text-sm capitalize",children:e.tipo}),(0,t.jsx)("td",{className:"border p-3 text-center",children:(0,t.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:w(e.duracion_minutos)})}),(0,t.jsx)("td",{className:"border p-3 text-center",children:e.evidencias&&e.evidencias.length>0?(0,t.jsxs)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded text-xs",children:["ðŸ“¸ ",e.evidencias.length]}):(0,t.jsx)("span",{className:"text-gray-400 text-xs",children:"Sin fotos"})}),(0,t.jsx)("td",{className:"border p-3 text-center",children:(0,t.jsx)("button",{onClick:()=>f.push(`/admin/historial/${e.id}`),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Ver Detalles"})})]},e.id))})]})})]})})}e.s(["default",()=>r])}]);