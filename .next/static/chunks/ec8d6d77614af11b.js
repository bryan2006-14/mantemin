(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33726,e=>{"use strict";let r=(0,e.i(24632).createClient)("https://aysoiacdxglzsuhtrfnp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5c29pYWNkeGdsenN1aHRyZm5wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDk2MjIsImV4cCI6MjA4MDAyNTYyMn0.5agJq8Jn_o2Mdwylq7LOHO0B8TAw2jJoJwnEjOsB950");e.s(["supabase",0,r])},18566,(e,r,a)=>{r.exports=e.r(76562)},20314,e=>{"use strict";var r=e.i(43476),a=e.i(71645),o=e.i(18566),s=e.i(33726);function l(){let e=(0,o.useRouter)(),[l,t]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[u,m]=(0,a.useState)([]),[b,g]=(0,a.useState)({codigo:"",marca:"",modelo:"",cliente_id:"",descripcion:"",estado:"operativo",foto_url:""});async function x(){let{data:e,error:r}=await s.supabase.from("clientes").select("id, nombre").order("nombre");!r&&e?m(e):console.error("Error al cargar clientes:",r)}(0,a.useEffect)(()=>{x()},[]);let p=async()=>{try{let{data:e,error:r}=await s.supabase.from("maquinas").select("codigo").order("id",{ascending:!1}).limit(1);if(!r&&e&&e.length>0){let r=e[0].codigo.replace(/\D/g,""),a=parseInt(r)||0,o=`MAQ-${String(a+1).padStart(4,"0")}`;g(e=>({...e,codigo:o}))}else g(e=>({...e,codigo:"MAQ-0001"}))}catch(r){console.error("Error al generar cÃ³digo:",r);let e=Date.now().toString().slice(-6);g(r=>({...r,codigo:`MAQ-${e}`}))}},h=e=>{let{name:r,value:a}=e.target;g(e=>({...e,[r]:a}))},f=async e=>{let r=e.target.files?.[0];if(r){if(!r.type.startsWith("image/"))return void alert("Por favor selecciona una imagen vÃ¡lida");if(r.size>5242880)return void alert("La imagen no debe superar los 5MB");try{i(!0);let e=r.name.split(".").pop(),a=`${Date.now()}-${Math.random().toString(36).substring(7)}.${e}`,o=`maquinas/${a}`,{data:l,error:t}=await s.supabase.storage.from("imagenes").upload(o,r,{cacheControl:"3600",upsert:!1});if(t){console.error("Error al subir imagen:",t),t.message.includes("Bucket not found")?alert('âŒ Error: El bucket "imagenes" no existe en Supabase.\n\nðŸ“ Pasos para solucionarlo:\n1. Ve a tu proyecto en Supabase\n2. Abre Storage en el menÃº lateral\n3. Crea un nuevo bucket llamado "imagenes"\n4. MÃ¡rcalo como pÃºblico (Public bucket)\n5. Guarda y vuelve a intentar'):alert("Error al subir la imagen: "+t.message);return}let{data:n}=s.supabase.storage.from("imagenes").getPublicUrl(o),c=n.publicUrl;console.log("Imagen subida exitosamente:",c),g(e=>({...e,foto_url:c})),d(URL.createObjectURL(r))}catch(e){console.error("Error:",e),alert("Error al procesar la imagen")}finally{i(!1)}}},y=async e=>{let{data:r,error:a}=await s.supabase.from("maquinas").select("id").eq("codigo",e).single();return null!==r},j=async r=>{if(r.preventDefault(),!b.codigo||!b.marca)return void alert("Por favor completa los campos requeridos");t(!0);try{if(await y(b.codigo)){alert(`âŒ El c\xf3digo "${b.codigo}" ya est\xe1 en uso.

Por favor usa un c\xf3digo diferente.`),t(!1);return}let{data:r,error:a}=await s.supabase.from("maquinas").insert([{codigo:b.codigo,marca:b.marca,modelo:b.modelo,cliente_id:b.cliente_id||null,descripcion:b.descripcion,estado:b.estado,foto_url:b.foto_url||null}]).select();if(a){console.error("Error al crear mÃ¡quina:",a),a.message.includes("duplicate key")?alert("âŒ El cÃ³digo ya existe. Por favor usa uno diferente."):a.message.includes("foreign key")?alert("âŒ El cliente seleccionado no existe."):alert("âŒ Error al crear la mÃ¡quina: "+a.message);return}console.log("MÃ¡quina creada:",r),alert("âœ… Â¡MÃ¡quina creada exitosamente!"),e.push("/admin/maquinas")}catch(e){console.error("Error:",e),alert("âŒ Error al guardar la mÃ¡quina")}finally{t(!1)}};return(0,r.jsxs)("div",{className:"p-6 max-w-2xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Nueva MÃ¡quina"}),(0,r.jsxs)("form",{onSubmit:j,className:"bg-white rounded-lg shadow-sm border p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Foto de la mÃ¡quina"}),c||b.foto_url?(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("img",{src:c||b.foto_url,alt:"Preview",className:"w-48 h-48 object-cover rounded-lg border-2 border-gray-300"}),(0,r.jsx)("button",{type:"button",onClick:()=>{g(e=>({...e,foto_url:""})),d(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600 shadow-lg",children:"âœ•"})]}):(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:f,disabled:n,className:"hidden",id:"file-upload"}),(0,r.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer",children:n?(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Subiendo imagen..."})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("svg",{className:"w-12 h-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Haz clic para subir una imagen"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG hasta 5MB"})]})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["CÃ³digo ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",name:"codigo",value:b.codigo,onChange:h,required:!0,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: MAQ-001"}),(0,r.jsx)("button",{type:"button",onClick:p,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-lg font-medium text-sm transition-colors whitespace-nowrap",title:"Generar cÃ³digo automÃ¡tico",children:"ðŸ”„ Auto"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:'El cÃ³digo debe ser Ãºnico. Usa el botÃ³n "Auto" para generar uno automÃ¡ticamente.'})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Marca ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",name:"marca",value:b.marca,onChange:h,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Caterpillar"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Modelo"}),(0,r.jsx)("input",{type:"text",name:"modelo",value:b.modelo,onChange:h,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: 320D"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Cliente"}),(0,r.jsxs)("select",{name:"cliente_id",value:b.cliente_id,onChange:h,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",children:[(0,r.jsx)("option",{value:"",children:"Seleccionar cliente (opcional)"}),u.map(e=>(0,r.jsx)("option",{value:e.id,children:e.nombre},e.id))]}),0===u.length&&(0,r.jsxs)("p",{className:"text-xs text-amber-600 mt-1",children:["âš ï¸ No hay clientes registrados.",(0,r.jsx)("a",{href:"/admin/clientes/crear",className:"underline ml-1",children:"Crear uno aquÃ­"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"DescripciÃ³n"}),(0,r.jsx)("textarea",{name:"descripcion",value:b.descripcion,onChange:h,rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe las caracterÃ­sticas de la mÃ¡quina..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Estado"}),(0,r.jsxs)("select",{name:"estado",value:b.estado,onChange:h,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"operativo",children:"Operativo"}),(0,r.jsx)("option",{value:"en mantenimiento",children:"En Mantenimiento"}),(0,r.jsx)("option",{value:"fuera de servicio",children:"Fuera de Servicio"})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",disabled:l||n,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:l?"Guardando...":"Guardar MÃ¡quina"}),(0,r.jsx)("button",{type:"button",onClick:()=>e.back(),disabled:l,className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})]})}e.s(["default",()=>l])}]);