(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33726,e=>{"use strict";let s=(0,e.i(24632).createClient)("https://aysoiacdxglzsuhtrfnp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5c29pYWNkeGdsenN1aHRyZm5wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDk2MjIsImV4cCI6MjA4MDAyNTYyMn0.5agJq8Jn_o2Mdwylq7LOHO0B8TAw2jJoJwnEjOsB950");e.s(["supabase",0,s])},18566,(e,s,a)=>{s.exports=e.r(76562)},37144,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(33726),i=e.i(18566);function n(){let e,n,l,r,o,[c,d]=(0,a.useState)([]),[m,x]=(0,a.useState)([]),[h,p]=(0,a.useState)(!0),[u,g]=(0,a.useState)("todos"),[j,b]=(0,a.useState)("todos"),[f,N]=(0,a.useState)(""),[v,w]=(0,a.useState)(null),y=(0,i.useRouter)();async function C(){try{let{data:e}=await t.supabase.from("usuarios").select("id, nombre, email").eq("rol","tecnico").order("nombre");x(e||[]);let s=t.supabase.from("ordenes").select(`
          *,
          maquinas:maquina_id (
            codigo,
            marca,
            modelo,
            clientes:cliente_id (
              nombre
            )
          )
        `).eq("estado","completada").order("fecha_fin",{ascending:!1});if("todos"!==u&&(s=s.eq("tecnico_id",u)),"ultima_semana"===j){let e=new Date;e.setDate(e.getDate()-7),s=s.gte("fecha_fin",e.toISOString())}else if("ultimo_mes"===j){let e=new Date;e.setDate(e.getDate()-30),s=s.gte("fecha_fin",e.toISOString())}else if("ultimo_trimestre"===j){let e=new Date;e.setDate(e.getDate()-90),s=s.gte("fecha_fin",e.toISOString())}let{data:a,error:i}=await s;if(i)throw i;let n=await Promise.all((a||[]).map(async e=>{let{data:s}=await t.supabase.from("usuarios").select("nombre, email").eq("id",e.tecnico_id).maybeSingle();return{...e,tecnico_nombre:s?.nombre||"Sin asignar"}}));console.log(`ðŸ“š ${n?.length||0} trabajos completados`),d(n)}catch(e){console.error("Error al cargar historial:",e),alert("Error al cargar historial: "+e.message)}finally{p(!1)}}function _(e,s){if(!e||!s)return"N/A";let a=new Date(e),t=new Date(s)-a,i=Math.floor(t/36e5),n=Math.floor(t%36e5/6e4);if(i>24){let e=Math.floor(i/24);return`${e}d ${i%24}h`}return`${i}h ${n}m`}if((0,a.useEffect)(()=>{C()},[u,j]),h)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Cargando historial..."})]})});let S=(n=(e=c.filter(e=>""===f||e.maquinas?.codigo?.toLowerCase().includes(f.toLowerCase())||e.maquinas?.clientes?.nombre?.toLowerCase().includes(f.toLowerCase())||e.tecnico_nombre?.toLowerCase().includes(f.toLowerCase()))).length,l=0,e.forEach(e=>{if(e.fecha_inicio&&e.fecha_fin){let s=new Date(e.fecha_inicio),a=new Date(e.fecha_fin);l+=a-s}}),r=Math.floor(l/36e5),o=n>0?Math.round(r/n):0,{total:n,tiempoTotalHoras:r,promedioHoras:o,porTipo:e.reduce((e,s)=>(e[s.tipo]=(e[s.tipo]||0)+1,e),{})}),D=c.filter(e=>""===f||e.maquinas?.codigo?.toLowerCase().includes(f.toLowerCase())||e.maquinas?.clientes?.nombre?.toLowerCase().includes(f.toLowerCase())||e.tecnico_nombre?.toLowerCase().includes(f.toLowerCase()));return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ“š Historial de Trabajos"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Registro completo de mantenimientos realizados"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:function(){let e=new Blob([[["Fecha","TÃ©cnico","MÃ¡quina","Cliente","Tipo","Prioridad","DuraciÃ³n","Estado"],...c.map(e=>[new Date(e.fecha_fin).toLocaleDateString("es-ES"),e.tecnico_nombre,e.maquinas?.codigo||"N/A",e.maquinas?.clientes?.nombre||"N/A",e.tipo,e.prioridad,_(e.fecha_inicio,e.fecha_fin),e.estado])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=`historial_${new Date().toISOString().split("T")[0]}.csv`,a.click()},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition",children:"ðŸ“¥ Exportar CSV"}),(0,s.jsx)("button",{onClick:()=>y.push("/admin"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"â† Volver"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-2",children:"Total Trabajos"}),(0,s.jsx)("p",{className:"text-4xl font-bold text-blue-600",children:S.total})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-2",children:"Tiempo Total"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:[S.tiempoTotalHoras,"h"]})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow text-center",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-2",children:"Promedio"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-purple-600",children:[S.promedioHoras,"h"]})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-2 text-sm",children:"Por Tipo"}),(0,s.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,s.jsxs)("p",{children:["Preventivo: ",(0,s.jsx)("strong",{children:S.porTipo.preventivo||0})]}),(0,s.jsxs)("p",{children:["Correctivo: ",(0,s.jsx)("strong",{children:S.porTipo.correctivo||0})]}),(0,s.jsxs)("p",{children:["Emergencia: ",(0,s.jsx)("strong",{children:S.porTipo.emergencia||0})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Buscar"}),(0,s.jsx)("input",{type:"text",placeholder:"MÃ¡quina, cliente o tÃ©cnico...",value:f,onChange:e=>N(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"TÃ©cnico"}),(0,s.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,s.jsx)("option",{value:"todos",children:"Todos los tÃ©cnicos"}),m.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"PerÃ­odo"}),(0,s.jsxs)("select",{value:j,onChange:e=>b(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,s.jsx)("option",{value:"todos",children:"Todos los perÃ­odos"}),(0,s.jsx)("option",{value:"ultima_semana",children:"Ãšltima Semana"}),(0,s.jsx)("option",{value:"ultimo_mes",children:"Ãšltimo Mes"}),(0,s.jsx)("option",{value:"ultimo_trimestre",children:"Ãšltimo Trimestre"})]})]})]}),f&&(0,s.jsxs)("p",{className:"mt-3 text-sm text-gray-600",children:["Mostrando ",D.length," de ",c.length," resultados"]})]}),0===D.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ“‹"}),(0,s.jsx)("h2",{className:"text-xl font-bold mb-2",children:"No se encontraron trabajos"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Los trabajos finalizados aparecerÃ¡n aquÃ­."})]}):(0,s.jsx)("div",{className:"space-y-4",children:D.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition p-6 cursor-pointer",onClick:()=>w(e),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsxs)("h3",{className:"font-bold text-lg",children:["Orden #",e.id]}),(0,s.jsx)("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full",children:"Completada"}),(0,s.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${"urgente"===e.prioridad?"bg-red-100 text-red-800":"alta"===e.prioridad?"bg-orange-100 text-orange-800":"media"===e.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:e.prioridad})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 capitalize",children:[e.tipo," - ",e.maquinas?.codigo," (",e.maquinas?.marca,")"]}),e.maquinas?.clientes?.nombre&&(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Cliente: ",e.maquinas.clientes.nombre]}),(0,s.jsxs)("p",{className:"text-sm text-blue-600 font-medium mt-1",children:["ðŸ‘¤ ",e.tecnico_nombre]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Finalizado"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(e.fecha_fin).toLocaleDateString("es-ES")}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.fecha_fin).toLocaleTimeString("es-ES")})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"DuraciÃ³n"}),(0,s.jsx)("p",{className:"font-medium text-sm",children:_(e.fecha_inicio,e.fecha_fin)})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Iniciado"}),(0,s.jsx)("p",{className:"font-medium text-sm",children:new Date(e.fecha_inicio).toLocaleDateString("es-ES")})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-2 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Completado"}),(0,s.jsx)("p",{className:"font-medium text-sm",children:new Date(e.fecha_fin).toLocaleDateString("es-ES")})]})]}),e.observaciones&&(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded border-l-4 border-blue-400",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Observaciones:"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 line-clamp-2",children:e.observaciones})]}),(0,s.jsx)("button",{onClick:s=>{s.stopPropagation(),w(e)},className:"mt-3 text-blue-600 text-sm hover:underline",children:"Ver detalles completos â†’"})]},e.id))}),v&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>w(null),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white p-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold mb-1",children:["Orden #",v.id]}),(0,s.jsx)("p",{className:"opacity-90",children:"Trabajo Completado"}),(0,s.jsxs)("p",{className:"text-sm opacity-75 mt-1",children:["ðŸ‘¤ TÃ©cnico: ",v.tecnico_nombre]})]}),(0,s.jsx)("button",{onClick:()=>w(null),className:"bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded transition",children:"âœ•"})]})}),(0,s.jsxs)("div",{className:"p-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ“ DescripciÃ³n"}),(0,s.jsx)("p",{className:"text-gray-700 bg-gray-50 p-3 rounded",children:v.descripcion||"Sin descripciÃ³n"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Tipo"}),(0,s.jsx)("p",{className:"font-medium capitalize",children:v.tipo})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Prioridad"}),(0,s.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"urgente"===v.prioridad?"bg-red-100 text-red-800":"alta"===v.prioridad?"bg-orange-100 text-orange-800":"media"===v.prioridad?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:v.prioridad})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"DuraciÃ³n Total"}),(0,s.jsx)("p",{className:"font-medium",children:_(v.fecha_inicio,v.fecha_fin)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,s.jsx)("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:"Completada"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ”§ InformaciÃ³n de MÃ¡quina"}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"CÃ³digo:"})," ",v.maquinas?.codigo||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Marca:"})," ",v.maquinas?.marca||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Modelo:"})," ",v.maquinas?.modelo||"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Cliente:"})," ",v.maquinas?.clientes?.nombre||"N/A"]})]})]}),v.observaciones&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ“‹ Observaciones / Trabajo Realizado"}),(0,s.jsx)("div",{className:"bg-blue-50 p-4 rounded border-l-4 border-blue-400",children:(0,s.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap",children:v.observaciones})})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"ðŸ• LÃ­nea de Tiempo"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Creada:"}),(0,s.jsx)("span",{className:"font-medium",children:new Date(v.created_at).toLocaleString("es-ES")})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Iniciada:"}),(0,s.jsx)("span",{className:"font-medium",children:new Date(v.fecha_inicio).toLocaleString("es-ES")})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Finalizada:"}),(0,s.jsx)("span",{className:"font-medium text-green-700",children:new Date(v.fecha_fin).toLocaleString("es-ES")})]})]})]})]})]})})]})})}e.s(["default",()=>n])}]);