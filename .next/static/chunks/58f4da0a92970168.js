(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33726,e=>{"use strict";let a=(0,e.i(24632).createClient)("https://aysoiacdxglzsuhtrfnp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5c29pYWNkeGdsenN1aHRyZm5wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDk2MjIsImV4cCI6MjA4MDAyNTYyMn0.5agJq8Jn_o2Mdwylq7LOHO0B8TAw2jJoJwnEjOsB950");e.s(["supabase",0,a])},18566,(e,a,r)=>{a.exports=e.r(76562)},8792,e=>{"use strict";var a=e.i(43476),r=e.i(71645),s=e.i(33726),i=e.i(18566);function n(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(l,{}),children:(0,a.jsx)(o,{})})}function l(){return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Cargando..."})]})})}function o(){let[e,n]=(0,r.useState)([]),[o,t]=(0,r.useState)([]),[c,d]=(0,r.useState)(null),[m,u]=(0,r.useState)({maquina_id:"",tecnico_id:"",descripcion:"",tipo:"preventivo",prioridad:"media",fecha_programada:""}),[x,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!0),b=(0,i.useRouter)(),j=(0,i.useSearchParams)();async function f(){try{console.log("ðŸ”„ Cargando datos...");let{data:e,error:a}=await s.supabase.from("maquinas").select("*").order("codigo");if(console.log("âœ… MÃ¡quinas cargadas:",e),a){console.error("âŒ Error al cargar mÃ¡quinas:",a),alert("Error al cargar mÃ¡quinas: "+a.message);return}let{data:r,error:i}=await s.supabase.from("clientes").select("id, nombre");console.log("âœ… Clientes cargados:",r),i&&console.error("âŒ Error al cargar clientes:",i);let l=(e||[]).map(e=>{let a=r?.find(a=>a.id===e.cliente_id);return{...e,cliente_nombre:a?.nombre||"Sin cliente"}});console.log("âœ… MÃ¡quinas con clientes:",l),n(l);let{data:o,error:c}=await s.supabase.from("usuarios").select("id, nombre, email, rol").eq("rol","tecnico").order("nombre");if(console.log("âœ… TÃ©cnicos cargados:",o),c){console.error("âŒ Error al cargar tÃ©cnicos:",c),alert("Error al cargar tÃ©cnicos: "+c.message);return}t(o||[])}catch(e){console.error("âŒ Error general:",e),alert("Error al cargar datos: "+e.message)}finally{p(!1)}}async function v(e){try{let{data:a,error:r}=await s.supabase.from("maquinas").select("*").eq("id",e).single();if(r)throw r;if(a?.cliente_id){let{data:e}=await s.supabase.from("clientes").select("*").eq("id",a.cliente_id).single();d({...a,cliente:e})}else d(a)}catch(e){console.error("Error al cargar detalles:",e)}}function N(e){let{name:a,value:r}=e.target;u(e=>({...e,[a]:r})),console.log(`Campo ${a} cambiado a:`,r)}async function y(e){if(e.preventDefault(),!m.maquina_id)return void alert("Por favor selecciona una mÃ¡quina");if(!m.tecnico_id)return void alert("Por favor selecciona un tÃ©cnico");if(!m.descripcion.trim())return void alert("Por favor describe el trabajo a realizar");g(!0);try{let e={maquina_id:parseInt(m.maquina_id),tecnico_id:m.tecnico_id,descripcion:m.descripcion.trim(),tipo:m.tipo,prioridad:m.prioridad,estado:"asignada",fecha_programada:m.fecha_programada||null};console.log("ðŸ“¤ Enviando orden:",e);let{data:a,error:r}=await s.supabase.from("ordenes").insert([e]).select();if(r)throw console.error("âŒ Error al crear orden:",r),r;console.log("âœ… Orden creada exitosamente:",a);let i=o.find(e=>e.id===m.tecnico_id)?.nombre;alert(`âœ… Orden de trabajo creada y asignada a ${i}

El t\xe9cnico ya puede verla en su panel.`),b.push("/admin/ordenes")}catch(e){console.error("âŒ Error completo:",e),alert("Error al crear orden: "+e.message)}finally{g(!1)}}return((0,r.useEffect)(()=>{f();let e=j.get("maquina");e&&u(a=>({...a,maquina_id:e}))},[j]),(0,r.useEffect)(()=>{m.maquina_id&&v(m.maquina_id)},[m.maquina_id]),h)?(0,a.jsx)(l,{}):(0,a.jsxs)("div",{className:"p-10 max-w-5xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Crear Orden de Trabajo"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Asignar tarea de mantenimiento a un tÃ©cnico"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("form",{onSubmit:y,className:"lg:col-span-2 bg-white p-6 rounded-lg shadow space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"MÃ¡quina *"}),(0,a.jsxs)("select",{name:"maquina_id",value:m.maquina_id,onChange:N,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",required:!0,children:[(0,a.jsx)("option",{value:"",children:"-- Seleccionar mÃ¡quina --"}),e.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.codigo," - ",e.cliente_nombre," (",e.marca," ",e.modelo,")"]},e.id))]}),0===e.length&&(0,a.jsxs)("div",{className:"mt-2 text-sm",children:[(0,a.jsx)("p",{className:"text-red-600",children:"âš ï¸ No hay mÃ¡quinas disponibles"}),(0,a.jsx)("button",{type:"button",onClick:()=>b.push("/admin/clientes"),className:"text-blue-600 underline mt-1",children:"â†’ Crear cliente y mÃ¡quinas"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"TÃ©cnico Asignado *"}),(0,a.jsxs)("select",{name:"tecnico_id",value:m.tecnico_id,onChange:N,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",required:!0,children:[(0,a.jsx)("option",{value:"",children:"-- Seleccionar tÃ©cnico --"}),o.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.nombre," - ",e.email]},e.id))]}),0===o.length&&(0,a.jsxs)("div",{className:"mt-2 text-sm",children:[(0,a.jsx)("p",{className:"text-red-600",children:"âš ï¸ No hay tÃ©cnicos disponibles"}),(0,a.jsx)("button",{type:"button",onClick:()=>b.push("/admin/tecnicos"),className:"text-blue-600 underline mt-1",children:"â†’ Registrar tÃ©cnicos"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tipo de Trabajo *"}),(0,a.jsxs)("select",{name:"tipo",value:m.tipo,onChange:N,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,a.jsx)("option",{value:"preventivo",children:"Mantenimiento Preventivo"}),(0,a.jsx)("option",{value:"correctivo",children:"Mantenimiento Correctivo"}),(0,a.jsx)("option",{value:"emergencia",children:"Emergencia"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prioridad *"}),(0,a.jsxs)("select",{name:"prioridad",value:m.prioridad,onChange:N,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,a.jsx)("option",{value:"baja",children:"Baja"}),(0,a.jsx)("option",{value:"media",children:"Media"}),(0,a.jsx)("option",{value:"alta",children:"Alta"}),(0,a.jsx)("option",{value:"urgente",children:"Urgente"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Fecha Programada"}),(0,a.jsx)("input",{type:"datetime-local",name:"fecha_programada",value:m.fecha_programada,onChange:N,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"DescripciÃ³n del Trabajo *"}),(0,a.jsx)("textarea",{name:"descripcion",value:m.descripcion,onChange:N,rows:"4",placeholder:"Detalla las actividades a realizar, repuestos necesarios, etc...",className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]}),m.tecnico_id&&m.maquina_id&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 p-3 rounded",children:(0,a.jsxs)("p",{className:"text-sm text-green-800",children:["âœ“ Asignando trabajo de ",(0,a.jsx)("strong",{children:e.find(e=>e.id==m.maquina_id)?.codigo})," a"," ",(0,a.jsx)("strong",{children:o.find(e=>e.id===m.tecnico_id)?.nombre})]})}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:x||0===o.length||0===e.length,className:"flex-1 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 transition disabled:bg-gray-400 font-medium",children:x?"Creando orden...":"âœ“ Crear y Asignar Orden"}),(0,a.jsx)("button",{type:"button",onClick:()=>b.push("/admin/ordenes"),className:"px-6 py-3 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"Cancelar"})]})]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:c?(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow sticky top-4",children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-4",children:"ðŸ“‹ InformaciÃ³n de la MÃ¡quina"}),c.foto_url&&(0,a.jsx)("img",{src:c.foto_url,alt:c.codigo,className:"w-full h-40 object-cover rounded mb-4"}),(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"CÃ³digo"}),(0,a.jsx)("p",{className:"font-bold text-lg",children:c.codigo})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Cliente"}),(0,a.jsx)("p",{className:"font-medium",children:c.cliente?.nombre||"Sin cliente"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Marca"}),(0,a.jsx)("p",{className:"font-medium",children:c.marca||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Modelo"}),(0,a.jsx)("p",{className:"font-medium",children:c.modelo||"N/A"})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-3 rounded",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"HorÃ³metro"}),(0,a.jsxs)("p",{className:"font-bold text-green-700",children:[c.horometro||0," hrs"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Estado"}),(0,a.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${"operativa"===c.estado?"bg-green-100 text-green-800":"mantenimiento"===c.estado?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:c.estado})]})]})]}):(0,a.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg text-center text-gray-600 sticky top-4",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"ðŸšœ"}),(0,a.jsx)("p",{className:"text-sm",children:"Selecciona una mÃ¡quina para ver sus detalles"})]})})]})]})}e.s(["default",()=>n])}]);