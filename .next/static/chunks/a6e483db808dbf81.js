(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,a,t)=>{a.exports=e.r(76562)},82082,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(33726),r=e.i(18566);function l(){let[e,l]=(0,t.useState)([]),[d,n]=(0,t.useState)("todas"),[i,o]=(0,t.useState)(!0),[c,x]=(0,t.useState)(null),m=(0,r.useRouter)();async function g(){try{let e=s.supabase.from("ordenes").select("*");"todas"!==d&&(e=e.eq("estado",d));let{data:a,error:t}=await e;if(t)throw console.error("Error detallado:",t),t;let r=await Promise.all((a||[]).map(async e=>{let{data:a}=await s.supabase.from("maquinas").select("codigo, marca, modelo, cliente_id").eq("id",e.maquina_id).maybeSingle(),t=null;if(a?.cliente_id){let{data:e}=await s.supabase.from("clientes").select("nombre").eq("id",a.cliente_id).maybeSingle();t=e}let{data:r}=await s.supabase.from("usuarios").select("nombre, email").eq("id",e.tecnico_id).maybeSingle();return{...e,maquinas:a?{...a,clientes:t}:null,usuarios:r}}));l(r)}catch(e){console.error("Error al cargar órdenes:",e),alert("Error al cargar órdenes: "+(e.message||"Error desconocido"))}finally{o(!1)}}async function h(a){if(confirm("¿Estás seguro de eliminar esta orden? Esta acción no se puede deshacer.")){x(a);try{let{error:t}=await s.supabase.from("ordenes").delete().eq("id",a);if(t)throw t;l(e.filter(e=>e.id!==a)),alert("✅ Orden eliminada correctamente")}catch(e){console.error("Error al eliminar:",e),alert("Error al eliminar orden: "+e.message)}finally{x(null)}}}return((0,t.useEffect)(()=>{g()},[d]),i)?(0,a.jsx)("div",{className:"p-10 flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Cargando órdenes..."})]})}):(0,a.jsxs)("div",{className:"p-10 max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Órdenes de Trabajo"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>m.push("/admin/ordenes/crear"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"+ Nueva Orden"}),(0,a.jsx)("button",{onClick:()=>m.push("/admin"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"← Volver"})]})]}),(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:(0,a.jsx)("div",{className:"flex gap-2 flex-wrap",children:["todas","pendiente","asignada","en_progreso","completada","cancelada"].map(e=>(0,a.jsx)("button",{onClick:()=>n(e),className:`px-4 py-2 rounded transition ${d===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e))})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Total"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:e.length})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg shadow text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Asignadas"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:e.filter(e=>"asignada"===e.estado).length})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg shadow text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"En Progreso"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:e.filter(e=>"en_progreso"===e.estado).length})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg shadow text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Completadas"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:e.filter(e=>"completada"===e.estado).length})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg shadow text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Pendientes"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-600",children:e.filter(e=>"pendiente"===e.estado).length})]})]}),0===e.length?(0,a.jsx)("div",{className:"bg-gray-50 p-8 rounded-lg text-center",children:(0,a.jsxs)("p",{className:"text-gray-600",children:["No hay órdenes ","todas"!==d?`con estado "${d}"`:"registradas"]})}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 text-left border",children:"Máquina/Cliente"}),(0,a.jsx)("th",{className:"p-3 text-left border",children:"Técnico"}),(0,a.jsx)("th",{className:"p-3 text-left border",children:"Tipo"}),(0,a.jsx)("th",{className:"p-3 text-center border",children:"Prioridad"}),(0,a.jsx)("th",{className:"p-3 text-center border",children:"Estado"}),(0,a.jsx)("th",{className:"p-3 text-left border",children:"Programada"}),(0,a.jsx)("th",{className:"p-3 text-center border",children:"Acciones"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition",children:[(0,a.jsxs)("td",{className:"border p-3",children:[(0,a.jsx)("p",{className:"font-medium",children:e.maquinas?.codigo||"Sin máquina"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:e.maquinas?.clientes?.nombre||"Sin cliente"})]}),(0,a.jsx)("td",{className:"border p-3 text-sm",children:e.usuarios?.nombre||"Sin asignar"}),(0,a.jsx)("td",{className:"border p-3 text-sm capitalize",children:e.tipo||"N/A"}),(0,a.jsx)("td",{className:"border p-3 text-center",children:(0,a.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{baja:"bg-blue-100 text-blue-800",media:"bg-yellow-100 text-yellow-800",alta:"bg-orange-100 text-orange-800",urgente:"bg-red-100 text-red-800"}[e.prioridad]||"bg-gray-100 text-gray-800"}`,children:e.prioridad||"media"})}),(0,a.jsx)("td",{className:"border p-3 text-center",children:(0,a.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{pendiente:"bg-gray-100 text-gray-800",asignada:"bg-blue-100 text-blue-800",en_progreso:"bg-yellow-100 text-yellow-800",completada:"bg-green-100 text-green-800",cancelada:"bg-red-100 text-red-800"}[e.estado]||"bg-gray-100 text-gray-800"}`,children:e.estado?.replace("_"," ")||"pendiente"})}),(0,a.jsx)("td",{className:"border p-3 text-xs",children:(t=e.fecha_programada)?new Date(t).toLocaleString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"No programada"}),(0,a.jsxs)("td",{className:"border p-3 text-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>m.push(`/admin/ordenes/${e.id}`),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Ver"}),(0,a.jsx)("button",{onClick:()=>h(e.id),disabled:c===e.id,className:`px-3 py-1 text-white rounded text-sm ${c===e.id?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:c===e.id?"Eliminando...":"Eliminar"})]})]},e.id)})})]})})]})}e.s(["default",()=>l])}]);