(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33726,e=>{"use strict";let a=(0,e.i(24632).createClient)("https://aysoiacdxglzsuhtrfnp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5c29pYWNkeGdsenN1aHRyZm5wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDk2MjIsImV4cCI6MjA4MDAyNTYyMn0.5agJq8Jn_o2Mdwylq7LOHO0B8TAw2jJoJwnEjOsB950");e.s(["supabase",0,a])},18566,(e,a,s)=>{a.exports=e.r(76562)},78774,e=>{"use strict";var a=e.i(43476),s=e.i(71645),r=e.i(33726),t=e.i(18566);function i(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)(l,{}),children:(0,a.jsx)(o,{})})}function l(){return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Cargando trabajo actual..."})]})})}function o(){let[e,i]=(0,s.useState)(null),[o,n]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[m,x]=(0,s.useState)(null),[h,b]=(0,s.useState)(null),[g,u]=(0,s.useState)(!0),[p,j]=(0,s.useState)(""),[f,N]=(0,s.useState)(!1),v=(0,t.useRouter)(),y=(0,t.useSearchParams)();async function w(){try{let e,{data:{session:a}}=await r.supabase.auth.getSession();if(!a)return void v.push("/login");x(a.user);let{data:s}=await r.supabase.from("usuarios").select("*").eq("email",a.user.email).eq("rol","tecnico").maybeSingle(),t=s?.id||a.user.id;b(t);let l=y.get("orden");if(l){let{data:a}=await r.supabase.from("ordenes").select("*").eq("id",l).eq("tecnico_id",t).single();e=a}else{let{data:a}=await r.supabase.from("ordenes").select("*").eq("tecnico_id",t).eq("estado","en_progreso").order("created_at",{ascending:!1}).limit(1).maybeSingle();e=a}if(!e){alert("No tienes trabajos en progreso"),v.push("tecnico/dashboard");return}i(e);let{data:o}=await r.supabase.from("maquinas").select("*").eq("id",e.maquina_id).maybeSingle();if(o&&(n(o),o.cliente_id)){let{data:e}=await r.supabase.from("clientes").select("*").eq("id",o.cliente_id).maybeSingle();d(e)}}catch(e){console.error("Error:",e),alert("Error al cargar trabajo: "+e.message)}finally{u(!1)}}async function S(){if(!e||!p.trim())return void alert("‚ö†Ô∏è Por favor ingresa observaciones antes de finalizar");if(p.trim().length<20)return void alert("‚ö†Ô∏è Las observaciones deben tener al menos 20 caracteres");if(confirm(`\xbfEst\xe1s seguro de finalizar este trabajo?

Orden: #${e.id}
Tipo: ${e.tipo}

Esto marcar\xe1 el trabajo como completado.`)){N(!0);try{let a=new Date().toISOString();console.log("üìã Finalizando orden:",e.id),console.log("üë§ T√©cnico ID:",h),console.log("üìù Observaciones:",p);let{error:s}=await r.supabase.from("ordenes").update({estado:"completada",fecha_fin:a,observaciones:p}).eq("id",e.id);if(s)throw console.error("Error al actualizar orden:",s),s;console.log("‚úÖ Orden actualizada correctamente");try{let{error:s}=await r.supabase.from("historial").insert({orden_id:e.id,tecnico_id:h,accion:"finalizar_trabajo",detalles:`Trabajo completado. Observaciones: ${p}`,fecha:a});s?console.warn("‚ö†Ô∏è No se pudo crear historial (tabla puede no existir):",s.message):console.log("‚úÖ Historial registrado")}catch(e){console.warn("‚ö†Ô∏è Error al registrar historial:",e.message)}alert("‚úÖ ¬°Trabajo finalizado correctamente!\n\nLa orden se ha movido al historial."),v.push("tecnico/dashboard")}catch(e){console.error("‚ùå Error al finalizar:",e),alert("‚ùå Error al finalizar: "+(e.message||"Error desconocido"))}finally{N(!1)}}}async function z(){if(confirm(`‚ö†Ô∏è \xbfEst\xe1s seguro de cancelar este trabajo?

Esto devolver\xe1 la orden al estado "Pendiente" y podr\xe1s iniciarla nuevamente despu\xe9s.`))try{let{error:a}=await r.supabase.from("ordenes").update({estado:"asignada",fecha_inicio:null}).eq("id",e.id);if(a)throw a;try{await r.supabase.from("historial").insert({orden_id:e.id,tecnico_id:h,accion:"cancelar_trabajo",detalles:"Trabajo cancelado por el t√©cnico",fecha:new Date().toISOString()})}catch(e){console.warn("‚ö†Ô∏è No se pudo registrar en historial:",e.message)}alert("‚è∏Ô∏è Trabajo cancelado. La orden volver√° a estar disponible."),v.push("tecnico/dashboard")}catch(e){console.error("Error:",e),alert("Error al cancelar: "+e.message)}}return((0,s.useEffect)(()=>{w()},[y]),g)?(0,a.jsx)(l,{}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"üöÄ Trabajo en Progreso"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Orden #",e?.id]})]}),(0,a.jsx)("button",{onClick:()=>v.push("tecnico/dashboard"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"‚Üê Volver al Panel"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-2",children:"üìù Descripci√≥n del Trabajo"}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded",children:(0,a.jsx)("p",{className:"text-gray-800",children:e?.descripcion||"Sin descripci√≥n"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Tipo"}),(0,a.jsx)("p",{className:"font-medium capitalize",children:e?.tipo})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Prioridad"}),(0,a.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${e?.prioridad==="urgente"?"bg-red-100 text-red-800":e?.prioridad==="alta"?"bg-orange-100 text-orange-800":e?.prioridad==="media"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:e?.prioridad})]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:(0,a.jsxs)("p",{children:["üïê Iniciado: ",new Date(e?.fecha_inicio||e?.created_at).toLocaleString("es-ES")]})})]}),o&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-4",children:"üöú M√°quina"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"C√≥digo"}),(0,a.jsx)("p",{className:"font-bold",children:o.codigo})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Marca/Modelo"}),(0,a.jsxs)("p",{children:[o.marca," ",o.modelo]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Hor√≥metro"}),(0,a.jsxs)("p",{className:"font-bold text-green-700",children:[o.horometro||0," hrs"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,a.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"operativa"===o.estado?"bg-green-100 text-green-800":"mantenimiento"===o.estado?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:o.estado})]})]})]}),c&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-4",children:"üë§ Cliente"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Nombre"}),(0,a.jsx)("p",{className:"font-medium",children:c.nombre})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Tel√©fono"}),(0,a.jsx)("p",{children:c.telefono||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Email"}),(0,a.jsx)("p",{children:c.email||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"RUC"}),(0,a.jsx)("p",{children:c.ruc||"N/A"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-4",children:"üìã Registrar Finalizaci√≥n"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Observaciones / Trabajo Realizado * ",(0,a.jsx)("span",{className:"text-red-500",children:"Requerido"})]}),(0,a.jsx)("textarea",{value:p,onChange:e=>j(e.target.value),placeholder:"Describe detalladamente:   ‚Ä¢ Actividades realizadas   ‚Ä¢ Repuestos o piezas utilizadas   ‚Ä¢ Problemas encontrados y solucionados   ‚Ä¢ Recomendaciones para el cliente   ‚Ä¢ Cualquier observaci√≥n importante...",rows:"6",className:"w-full p-3 border rounded focus:ring-2 focus:ring-blue-500 outline-none",required:!0}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["M√≠nimo 20 caracteres ‚Ä¢ ",p.length," caracteres escritos"]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:S,disabled:f||p.trim().length<20,className:`flex-1 py-3 text-white rounded font-bold transition ${f||p.trim().length<20?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 shadow-lg hover:shadow-xl"}`,children:f?"‚è≥ Finalizando...":"‚úÖ Finalizar Trabajo"}),(0,a.jsx)("button",{onClick:z,disabled:f,className:"px-6 py-3 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-400",children:"‚è∏Ô∏è Cancelar"})]}),p.trim().length<20&&p.length>0&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-2",children:"‚ö†Ô∏è Las observaciones deben tener al menos 20 caracteres"})]})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"üìã"}),(0,a.jsx)("h2",{className:"text-xl font-bold mb-2",children:"No hay trabajo en progreso"}),(0,a.jsx)("button",{onClick:()=>v.push("tecnico/dashboard"),className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Volver al Panel"})]})})}e.s(["default",()=>i])}]);