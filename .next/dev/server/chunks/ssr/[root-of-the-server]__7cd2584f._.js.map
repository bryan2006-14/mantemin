{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BRAYAN/Desktop/mantemin2.0/components/ChatAdminTechnician.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\nimport { RealtimeChannel } from \"@supabase/supabase-js\";\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n\r\ninterface Message {\r\n  id: string;\r\n  conversation_id: string;\r\n  sender_id: string;\r\n  sender_type: string;\r\n  message: string;\r\n  created_at: string;\r\n  read: boolean;\r\n}\r\n\r\ninterface Conversation {\r\n  id: string;\r\n  admin_id: string;\r\n  technician_id: string;\r\n  last_message: string;\r\n  updated_at: string;\r\n  other_user_name?: string;\r\n  unread_count: number;\r\n}\r\n\r\ninterface Usuario {\r\n  id: string;\r\n  email: string;\r\n  nombre: string;\r\n  rol: string;\r\n}\r\n\r\n// Helper functions para formatear fechas\r\nconst formatTime = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  return date.toLocaleTimeString('es-PE', { \r\n    hour: '2-digit', \r\n    minute: '2-digit',\r\n    hour12: false \r\n  });\r\n};\r\n\r\nconst formatDate = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  const now = new Date();\r\n  const diffInMs = now.getTime() - date.getTime();\r\n  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\r\n  \r\n  const daysOfWeek = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];\r\n  const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];\r\n  \r\n  if (diffInDays === 0) {\r\n    return formatTime(dateString);\r\n  } else if (diffInDays === 1) {\r\n    return `Ayer ${formatTime(dateString)}`;\r\n  } else if (diffInDays < 7) {\r\n    return `${daysOfWeek[date.getDay()]} ${formatTime(dateString)}`;\r\n  } else {\r\n    return `${date.getDate()}/${months[date.getMonth()]} ${formatTime(dateString)}`;\r\n  }\r\n};\r\n\r\nconst formatConversationTime = (dateString: string): string => {\r\n  const date = new Date(dateString);\r\n  const now = new Date();\r\n  const diffInMs = now.getTime() - date.getTime();\r\n  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\r\n  \r\n  const daysOfWeek = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];\r\n  \r\n  if (diffInDays === 0) {\r\n    return formatTime(dateString);\r\n  } else if (diffInDays === 1) {\r\n    return \"Ayer\";\r\n  } else if (diffInDays < 7) {\r\n    return daysOfWeek[date.getDay()];\r\n  } else {\r\n    return `${date.getDate()}/${date.getMonth() + 1}`;\r\n  }\r\n};\r\n\r\n// Componente de mensaje individual\r\nconst MessageItem = ({ \r\n  msg, \r\n  currentUser, \r\n  onEdit, \r\n  onDelete,\r\n  isEditing,\r\n  editText,\r\n  onSaveEdit,\r\n  onCancelEdit,\r\n  onSetEditText\r\n}: {\r\n  msg: Message;\r\n  currentUser: Usuario | null;\r\n  onEdit: (msg: Message) => void;\r\n  onDelete: (messageId: string) => void;\r\n  isEditing: boolean;\r\n  editText: string;\r\n  onSaveEdit: (messageId: string) => void;\r\n  onCancelEdit: () => void;\r\n  onSetEditText: (text: string) => void;\r\n}) => {\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  const isOwn = msg.sender_id === currentUser?.id;\r\n\r\n  // Cerrar men√∫ al hacer clic fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        setMenuOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  if (isEditing) {\r\n    return (\r\n      <div className={`flex ${isOwn ? \"justify-end\" : \"justify-start\"} mb-2`}>\r\n        <div className=\"max-w-xs lg:max-w-md w-full\">\r\n          <div className=\"bg-blue-50 p-3 rounded-2xl rounded-br-none border border-blue-100\">\r\n            <textarea\r\n              value={editText}\r\n              onChange={(e) => onSetEditText(e.target.value)}\r\n              className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none\"\r\n              rows={3}\r\n              autoFocus\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  e.preventDefault();\r\n                  onSaveEdit(msg.id);\r\n                }\r\n                if (e.key === 'Escape') {\r\n                  onCancelEdit();\r\n                }\r\n              }}\r\n            />\r\n            <div className=\"flex justify-end space-x-2 mt-2\">\r\n              <button\r\n                onClick={() => onSaveEdit(msg.id)}\r\n                className=\"px-3 py-1 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors\"\r\n                disabled={!editText.trim()}\r\n              >\r\n                ‚úì Guardar\r\n              </button>\r\n              <button\r\n                onClick={onCancelEdit}\r\n                className=\"px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300 transition-colors\"\r\n              >\r\n                ‚úï Cancelar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`flex ${isOwn ? \"justify-end\" : \"justify-start\"} mb-2 group`}>\r\n      <div className=\"relative max-w-xs lg:max-w-md\" ref={menuRef}>\r\n        <div\r\n          className={`px-4 py-3 rounded-2xl ${isOwn\r\n            ? \"bg-blue-600 text-white rounded-br-none\"\r\n            : \"bg-white text-gray-900 rounded-bl-none shadow-sm\"\r\n            } hover:shadow-md transition-shadow`}\r\n        >\r\n          <p className=\"break-words whitespace-pre-wrap\">{msg.message}</p>\r\n          <div className=\"flex items-center justify-end mt-1\">\r\n            <span className={`text-xs ${isOwn ? \"text-blue-200\" : \"text-gray-400\"}`}>\r\n              {formatDate(msg.created_at)}\r\n              {msg.read && isOwn && \" ‚úì‚úì\"}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Bot√≥n de opciones - disponible para todos los mensajes */}\r\n        <div className={`absolute top-0 ${isOwn ? '-left-8' : '-right-8'} opacity-0 group-hover:opacity-100 transition-opacity`}>\r\n          <button\r\n            onClick={() => setMenuOpen(!menuOpen)}\r\n            className=\"p-1.5 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors shadow-sm\"\r\n          >\r\n            <svg className=\"w-4 h-4 text-gray-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path d=\"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z\" />\r\n            </svg>\r\n          </button>\r\n\r\n          {menuOpen && (\r\n            <div className={`absolute ${isOwn ? 'left-0' : 'right-0'} mt-1 bg-white shadow-lg rounded-lg py-1 z-50 w-40 border border-gray-100`}>\r\n              {/* Solo el remitente puede editar */}\r\n              {isOwn && (\r\n                <button\r\n                  onClick={() => {\r\n                    onEdit(msg);\r\n                    setMenuOpen(false);\r\n                  }}\r\n                  className=\"w-full px-4 py-2 text-left text-sm hover:bg-blue-50 flex items-center space-x-2 text-gray-700\"\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                  </svg>\r\n                  <span>Editar</span>\r\n                </button>\r\n              )}\r\n              \r\n              {/* Todos pueden eliminar */}\r\n              <button\r\n                onClick={() => {\r\n                  if (confirm(\"¬øEst√°s seguro de eliminar este mensaje para todos?\")) {\r\n                    onDelete(msg.id);\r\n                  }\r\n                  setMenuOpen(false);\r\n                }}\r\n                className=\"w-full px-4 py-2 text-left text-sm hover:bg-red-50 flex items-center space-x-2 text-red-600\"\r\n              >\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                </svg>\r\n                <span>Eliminar para todos</span>\r\n              </button>\r\n              \r\n              {/* Opci√≥n de responder/citar mensaje */}\r\n              <div className=\"border-t border-gray-100 my-1\"></div>\r\n              <button\r\n                onClick={() => {\r\n                  setMenuOpen(false);\r\n                }}\r\n                className=\"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center space-x-2 text-gray-700\"\r\n              >\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6\" />\r\n                </svg>\r\n                <span>Responder</span>\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default function ChatAdminTechnician() {\r\n  const [currentUser, setCurrentUser] = useState<Usuario | null>(null);\r\n  const [conversations, setConversations] = useState<Conversation[]>([]);\r\n  const [technicians, setTechnicians] = useState<Usuario[]>([]);\r\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [editingMessage, setEditingMessage] = useState<string | null>(null);\r\n  const [editText, setEditText] = useState(\"\");\r\n  const [isSending, setIsSending] = useState(false);\r\n  const [typing, setTyping] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const conversationListRef = useRef<HTMLDivElement>(null);\r\n  const realtimeChannels = useRef<RealtimeChannel[]>([]);\r\n\r\n  // Cargar usuario actual\r\n  useEffect(() => {\r\n    loadCurrentUser();\r\n\r\n    // Limpiar canales al desmontar\r\n    return () => {\r\n      realtimeChannels.current.forEach(channel => {\r\n        supabase.removeChannel(channel);\r\n      });\r\n    };\r\n  }, []);\r\n\r\n  // Suscripci√≥n global a todas las conversaciones del usuario\r\n  useEffect(() => {\r\n    if (!currentUser) return;\r\n\r\n    // Limpiar canales anteriores\r\n    realtimeChannels.current.forEach(channel => {\r\n      supabase.removeChannel(channel);\r\n    });\r\n    realtimeChannels.current = [];\r\n\r\n    // Canal 1: Suscripci√≥n a mensajes de TODAS las conversaciones del usuario\r\n    const messagesChannel = supabase\r\n      .channel(`global-messages-${currentUser.id}`)\r\n      .on(\r\n        \"postgres_changes\",\r\n        {\r\n          event: \"*\",\r\n          schema: \"public\",\r\n          table: \"messages\",\r\n          filter: `sender_id=neq.${currentUser.id}`, // Solo mensajes de otros\r\n        },\r\n        async (payload) => {\r\n          console.log(\"üåç Evento global de mensaje:\", payload.eventType, payload.new);\r\n          \r\n          // Si es un INSERT, actualizar conversaciones\r\n          if (payload.eventType === \"INSERT\") {\r\n            const newMsg = payload.new as Message;\r\n            \r\n            // Si estamos viendo esta conversaci√≥n, agregar mensaje\r\n            if (selectedConversation === newMsg.conversation_id) {\r\n              setMessages(prev => {\r\n                if (prev.some(msg => msg.id === newMsg.id)) return prev;\r\n                return [...prev, newMsg];\r\n              });\r\n              scrollToBottom();\r\n              markMessagesAsRead(newMsg.conversation_id);\r\n            }\r\n            \r\n            // Recargar conversaciones para actualizar orden y contador\r\n            await loadConversations();\r\n          }\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    realtimeChannels.current.push(messagesChannel);\r\n\r\n    // Canal 2: Suscripci√≥n a conversaciones\r\n    const conversationsChannel = supabase\r\n      .channel(`global-conversations-${currentUser.id}`)\r\n      .on(\r\n        \"postgres_changes\",\r\n        {\r\n          event: \"*\",\r\n          schema: \"public\",\r\n          table: \"conversations\",\r\n          filter: currentUser.rol === \"admin\" \r\n            ? `admin_id=eq.${currentUser.id}` \r\n            : `technician_id=eq.${currentUser.id}`,\r\n        },\r\n        async (payload) => {\r\n          console.log(\"üîÑ Evento global de conversaci√≥n:\", payload.eventType, payload.new);\r\n          \r\n          // Recargar conversaciones cuando hay cambios\r\n          await loadConversations();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    realtimeChannels.current.push(conversationsChannel);\r\n\r\n    return () => {\r\n      supabase.removeChannel(messagesChannel);\r\n      supabase.removeChannel(conversationsChannel);\r\n    };\r\n  }, [currentUser, selectedConversation]);\r\n\r\n  // Cargar conversaciones y t√©cnicos cuando cambia el usuario\r\n  useEffect(() => {\r\n    if (currentUser) {\r\n      console.log(\"‚úÖ Current user:\", currentUser);\r\n      if (currentUser.rol === \"admin\") {\r\n        loadTechnicians();\r\n      }\r\n      loadConversations();\r\n    }\r\n  }, [currentUser]);\r\n\r\n  // Cargar mensajes cuando se selecciona conversaci√≥n\r\n  useEffect(() => {\r\n    if (selectedConversation) {\r\n      loadMessages(selectedConversation);\r\n      markMessagesAsRead(selectedConversation);\r\n      \r\n      // Suscripci√≥n espec√≠fica para esta conversaci√≥n\r\n      const conversationChannel = supabase\r\n        .channel(`specific-conversation-${selectedConversation}`)\r\n        .on(\r\n          \"postgres_changes\",\r\n          {\r\n            event: \"*\",\r\n            schema: \"public\",\r\n            table: \"messages\",\r\n            filter: `conversation_id=eq.${selectedConversation}`,\r\n          },\r\n          (payload) => {\r\n            handleRealtimeMessage(payload);\r\n          }\r\n        )\r\n        .subscribe();\r\n\r\n      realtimeChannels.current.push(conversationChannel);\r\n\r\n      return () => {\r\n        supabase.removeChannel(conversationChannel);\r\n      };\r\n    }\r\n  }, [selectedConversation]);\r\n\r\n  // Configurar intervalo para actualizaciones peri√≥dicas\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      if (currentUser) {\r\n        loadConversations();\r\n      }\r\n    }, 15000); // Actualizar cada 15 segundos\r\n\r\n    return () => clearInterval(interval);\r\n  }, [currentUser]);\r\n\r\n  const handleRealtimeMessage = useCallback((payload: any) => {\r\n    console.log(\"üì® Evento espec√≠fico de mensaje:\", payload.eventType, payload.new);\r\n    \r\n    switch (payload.eventType) {\r\n      case \"INSERT\":\r\n        setMessages(prev => {\r\n          if (prev.some(msg => msg.id === payload.new.id)) return prev;\r\n          return [...prev, payload.new as Message];\r\n        });\r\n        scrollToBottom();\r\n        break;\r\n        \r\n      case \"UPDATE\":\r\n        setMessages(prev =>\r\n          prev.map(msg => (msg.id === payload.new.id ? payload.new as Message : msg))\r\n        );\r\n        break;\r\n        \r\n      case \"DELETE\":\r\n        setMessages(prev => prev.filter(msg => msg.id !== payload.old.id));\r\n        break;\r\n    }\r\n  }, []);\r\n\r\n  // Detectar cuando el usuario est√° escribiendo\r\n  useEffect(() => {\r\n    const typingTimeout = setTimeout(() => {\r\n      setTyping(false);\r\n    }, 1500);\r\n\r\n    return () => clearTimeout(typingTimeout);\r\n  }, [newMessage]);\r\n\r\n  const scrollToBottom = () => {\r\n    setTimeout(() => {\r\n      messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, 100);\r\n  };\r\n\r\n  const scrollConversationToTop = () => {\r\n    if (conversationListRef.current) {\r\n      conversationListRef.current.scrollTop = 0;\r\n    }\r\n  };\r\n\r\n  const loadCurrentUser = async () => {\r\n    try {\r\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n      \r\n      if (authError || !user) {\r\n        setError(\"‚ùå No hay usuario autenticado\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      let { data: usuario, error: usuarioError } = await supabase\r\n        .from(\"usuarios\")\r\n        .select(\"*\")\r\n        .eq(\"id\", user.id)\r\n        .maybeSingle();\r\n      \r\n      if (!usuario) {\r\n        console.log(\"‚ö†Ô∏è Usuario no existe en tabla usuarios, creando...\");\r\n        \r\n        const { data: nuevoUsuario, error: insertError } = await supabase\r\n          .from(\"usuarios\")\r\n          .insert({\r\n            id: user.id,\r\n            email: user.email,\r\n            nombre: user.email?.split('@')[0] || 'Usuario',\r\n            rol: 'tecnico',\r\n            activo: true\r\n          })\r\n          .select()\r\n          .single();\r\n\r\n        if (insertError) {\r\n          console.error(\"‚ùå Error creando usuario:\", insertError);\r\n          setError(\"No se pudo crear el usuario en la base de datos. Error: \" + insertError.message);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        usuario = nuevoUsuario;\r\n      }\r\n\r\n      setCurrentUser(usuario);\r\n      setLoading(false);\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error:\", err);\r\n      setError(\"Error general: \" + err.message);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadTechnicians = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"usuarios\")\r\n        .select(\"*\")\r\n        .eq(\"rol\", \"tecnico\")\r\n        .order(\"nombre\", { ascending: true });\r\n      \r\n      if (error) throw error;\r\n      setTechnicians(data || []);\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error cargando t√©cnicos:\", err);\r\n    }\r\n  };\r\n\r\n  const loadConversations = async () => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      let query;\r\n      if (currentUser.rol === \"admin\") {\r\n        query = supabase\r\n          .from(\"conversations\")\r\n          .select(\"*\")\r\n          .eq(\"admin_id\", currentUser.id)\r\n          .order(\"updated_at\", { ascending: false });\r\n      } else {\r\n        query = supabase\r\n          .from(\"conversations\")\r\n          .select(\"*\")\r\n          .eq(\"technician_id\", currentUser.id)\r\n          .order(\"updated_at\", { ascending: false });\r\n      }\r\n\r\n      const { data, error } = await query;\r\n      \r\n      if (error) throw error;\r\n\r\n      if (data && data.length > 0) {\r\n        const conversationsWithNames = await Promise.all(\r\n          data.map(async (conv) => {\r\n            const otherId = currentUser.rol === \"admin\" ? conv.technician_id : conv.admin_id;\r\n            \r\n            const { data: otherUser } = await supabase\r\n              .from(\"usuarios\")\r\n              .select(\"nombre, email\")\r\n              .eq(\"id\", otherId)\r\n              .single();\r\n            \r\n            // Calcular mensajes no le√≠dos\r\n            const { count } = await supabase\r\n              .from(\"messages\")\r\n              .select(\"*\", { count: \"exact\", head: true })\r\n              .eq(\"conversation_id\", conv.id)\r\n              .neq(\"sender_id\", currentUser.id)\r\n              .eq(\"read\", false);\r\n\r\n            return {\r\n              ...conv,\r\n              other_user_name: otherUser?.nombre || otherUser?.email || \"Usuario\",\r\n              unread_count: count || 0\r\n            };\r\n          })\r\n        );\r\n        \r\n        setConversations(conversationsWithNames);\r\n      } else {\r\n        setConversations([]);\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error cargando conversaciones:\", err);\r\n    }\r\n  };\r\n\r\n  const loadMessages = async (conversationId: string) => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"messages\")\r\n        .select(\"*\")\r\n        .eq(\"conversation_id\", conversationId)\r\n        .order(\"created_at\", { ascending: true });\r\n      \r\n      if (error) throw error;\r\n      setMessages(data || []);\r\n      setTimeout(scrollToBottom, 100);\r\n    } catch (err) {\r\n      console.error(\"‚ùå Error cargando mensajes:\", err);\r\n    }\r\n  };\r\n\r\n  const markMessagesAsRead = async (conversationId: string) => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      await supabase\r\n        .from(\"messages\")\r\n        .update({ read: true })\r\n        .eq(\"conversation_id\", conversationId)\r\n        .neq(\"sender_id\", currentUser.id)\r\n        .eq(\"read\", false);\r\n      \r\n      // Actualizar contador en conversaciones\r\n      setConversations(prev =>\r\n        prev.map(conv =>\r\n          conv.id === conversationId ? { ...conv, unread_count: 0 } : conv\r\n        )\r\n      );\r\n    } catch (err) {\r\n      console.error(\"‚ùå Error marcando mensajes como le√≠dos:\", err);\r\n    }\r\n  };\r\n\r\n  const startConversation = async (technicianId: string) => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      const { data: existing, error: searchError } = await supabase\r\n        .from(\"conversations\")\r\n        .select(\"*\")\r\n        .eq(\"admin_id\", currentUser.id)\r\n        .eq(\"technician_id\", technicianId)\r\n        .maybeSingle();\r\n\r\n      if (searchError) throw searchError;\r\n\r\n      if (existing) {\r\n        setSelectedConversation(existing.id);\r\n        return;\r\n      }\r\n\r\n      const { data: newConv, error: insertError } = await supabase\r\n        .from(\"conversations\")\r\n        .insert({\r\n          admin_id: currentUser.id,\r\n          technician_id: technicianId,\r\n          last_message: \"\",\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (insertError) throw insertError;\r\n\r\n      if (newConv) {\r\n        await loadConversations();\r\n        setSelectedConversation(newConv.id);\r\n        scrollConversationToTop();\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error creando conversaci√≥n:\", err);\r\n      setError(\"Error al crear conversaci√≥n: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !selectedConversation || !currentUser || isSending) return;\r\n\r\n    setIsSending(true);\r\n    const messageToSend = newMessage.trim();\r\n    const senderType = currentUser.rol === \"admin\" ? \"admin\" : \"tecnico\";\r\n\r\n    try {\r\n      // Enviar mensaje\r\n      const { error } = await supabase.from(\"messages\").insert({\r\n        conversation_id: selectedConversation,\r\n        sender_id: currentUser.id,\r\n        sender_type: senderType,\r\n        message: messageToSend,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      // Actualizar conversaci√≥n\r\n      await supabase\r\n        .from(\"conversations\")\r\n        .update({\r\n          last_message: messageToSend,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", selectedConversation);\r\n\r\n      // Actualizar UI inmediatamente\r\n      setNewMessage(\"\");\r\n      setTyping(false);\r\n      \r\n      // Forzar recarga de conversaciones para actualizar orden\r\n      await loadConversations();\r\n      \r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error enviando mensaje:\", err);\r\n      alert(\"Error al enviar mensaje: \" + err.message);\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  };\r\n\r\n  const deleteMessage = async (messageId: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"messages\")\r\n        .delete()\r\n        .eq(\"id\", messageId);\r\n\r\n      if (error) throw error;\r\n      \r\n      console.log(\"‚úÖ Mensaje eliminado para todos\");\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error eliminando mensaje:\", err);\r\n      alert(\"Error al eliminar mensaje: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const startEdit = (message: Message) => {\r\n    setEditingMessage(message.id);\r\n    setEditText(message.message);\r\n  };\r\n\r\n  const saveEdit = async (messageId: string) => {\r\n    if (!editText.trim()) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"messages\")\r\n        .update({ message: editText.trim() })\r\n        .eq(\"id\", messageId);\r\n\r\n      if (error) throw error;\r\n      \r\n      setEditingMessage(null);\r\n      setEditText(\"\");\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error editando mensaje:\", err);\r\n      alert(\"Error al editar mensaje: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const cancelEdit = () => {\r\n    setEditingMessage(null);\r\n    setEditText(\"\");\r\n  };\r\n\r\n  const handleTyping = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setNewMessage(e.target.value);\r\n    setTyping(true);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600 font-medium\">Cargando chat...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\r\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8\">\r\n          <div className=\"text-center mb-6\">\r\n            <div className=\"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <span className=\"text-3xl\">‚ö†Ô∏è</span>\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold text-red-600 mb-2\">Error</h2>\r\n            <p className=\"text-gray-700 mb-6\">{error}</p>\r\n            <button\r\n              onClick={() => window.location.reload()}\r\n              className=\"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all font-medium\"\r\n            >\r\n              Recargar p√°gina\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!currentUser) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\r\n        <div className=\"text-center bg-white p-10 rounded-2xl shadow-xl\">\r\n          <div className=\"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n            <span className=\"text-4xl\">üîí</span>\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold mb-2\">No autenticado</h2>\r\n          <p className=\"text-gray-600 mb-6\">Por favor inicia sesi√≥n</p>\r\n          <button\r\n            onClick={() => window.location.href = \"/login\"}\r\n            className=\"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all\"\r\n          >\r\n            Ir a login\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-gradient-to-br from-gray-50 to-blue-50\">\r\n      {/* Sidebar - Lista de conversaciones */}\r\n      <div className=\"w-80 bg-white border-r border-gray-200 flex flex-col shadow-lg\">\r\n        <div className=\"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-purple-600\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-2xl font-bold text-white\">üí¨ Mensajes</h2>\r\n            <button\r\n              onClick={loadConversations}\r\n              className=\"p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors\"\r\n              title=\"Actualizar conversaciones\"\r\n            >\r\n              <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n          <p className=\"text-sm text-blue-100 mb-2\">\r\n            {currentUser?.rol === \"admin\" ? \"Chat con T√©cnicos\" : \"Chat con Admin\"}\r\n          </p>\r\n          <div className=\"flex items-center space-x-2\">\r\n            <div className=\"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center\">\r\n              <span className=\"text-white font-bold text-sm\">\r\n                {currentUser.nombre?.charAt(0).toUpperCase()}\r\n              </span>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-white\">{currentUser.nombre}</span>\r\n            <span className=\"px-2 py-0.5 bg-white/30 text-xs text-white rounded-full\">\r\n              {currentUser.rol}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {currentUser?.rol === \"admin\" && (\r\n          <div className=\"p-4 border-b border-gray-200\">\r\n            {technicians.length === 0 ? (\r\n              <div className=\"text-center p-3 bg-yellow-50 rounded-xl border border-yellow-100\">\r\n                <p className=\"text-sm text-yellow-700 font-medium\">‚ö†Ô∏è No hay t√©cnicos disponibles</p>\r\n              </div>\r\n            ) : (\r\n              <select\r\n                onChange={(e) => {\r\n                  if (e.target.value) startConversation(e.target.value);\r\n                }}\r\n                value=\"\"\r\n                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all bg-white hover:border-gray-400\"\r\n              >\r\n                <option value=\"\">‚ûï Nueva conversaci√≥n</option>\r\n                {technicians.map((tech) => (\r\n                  <option key={tech.id} value={tech.id}>\r\n                    üë®‚Äçüîß {tech.nombre}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex-1 overflow-y-auto\" ref={conversationListRef}>\r\n          {conversations.length === 0 ? (\r\n            <div className=\"p-8 text-center\">\r\n              <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                <span className=\"text-3xl\">üí¨</span>\r\n              </div>\r\n              <p className=\"font-semibold text-gray-700 mb-2\">No hay conversaciones</p>\r\n              {currentUser.rol === \"admin\" ? (\r\n                <p className=\"text-sm text-gray-500\">Selecciona un t√©cnico arriba</p>\r\n              ) : (\r\n                <p className=\"text-sm text-gray-500\">Espera a que el admin te contacte</p>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            conversations.map((conv) => (\r\n              <div\r\n                key={conv.id}\r\n                onClick={() => setSelectedConversation(conv.id)}\r\n                className={`p-4 border-b border-gray-100 cursor-pointer transition-all hover:bg-gray-50 active:bg-gray-100\r\n                  ${selectedConversation === conv.id \r\n                    ? \"bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-l-blue-500\" \r\n                    : \"\"}`}\r\n              >\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"relative\">\r\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-lg\">\r\n                      {conv.other_user_name?.charAt(0).toUpperCase()}\r\n                    </div>\r\n                    {conv.unread_count > 0 && (\r\n                      <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center\">\r\n                        <span className=\"text-xs font-bold text-white\">{conv.unread_count}</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <h4 className=\"font-semibold text-gray-900 truncate\">\r\n                        {conv.other_user_name}\r\n                      </h4>\r\n                      <span className=\"text-xs text-gray-400 whitespace-nowrap\">\r\n                        {formatConversationTime(conv.updated_at)}\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-sm text-gray-500 truncate mt-1\">\r\n                      {conv.last_message || \"Sin mensajes\"}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Panel de chat principal */}\r\n      <div className=\"flex-1 flex flex-col\">\r\n        {selectedConversation ? (\r\n          <>\r\n            <div className=\"p-4 bg-white border-b border-gray-200 shadow-sm\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"relative\">\r\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg\">\r\n                      {conversations\r\n                        .find((c) => c.id === selectedConversation)\r\n                        ?.other_user_name?.charAt(0)\r\n                        .toUpperCase()}\r\n                    </div>\r\n                    <div className=\"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"></div>\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"font-bold text-gray-900 text-lg\">\r\n                      {conversations.find((c) => c.id === selectedConversation)?.other_user_name}\r\n                    </h3>\r\n                    <p className=\"text-sm text-green-600 font-medium flex items-center\">\r\n                      <span className=\"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse\"></span>\r\n                      En l√≠nea ‚Ä¢ Activo ahora\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  {typing && (\r\n                    <div className=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm animate-pulse\">\r\n                      Escribiendo...\r\n                    </div>\r\n                  )}\r\n                  <button\r\n                    onClick={() => loadMessages(selectedConversation)}\r\n                    className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-colors\"\r\n                    title=\"Actualizar mensajes\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-y-auto p-4 bg-gradient-to-b from-gray-50 to-blue-50\">\r\n              {messages.length === 0 ? (\r\n                <div className=\"flex items-center justify-center h-full\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"w-24 h-24 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                      <span className=\"text-4xl\">üëã</span>\r\n                    </div>\r\n                    <h3 className=\"text-xl font-bold text-gray-700 mb-2\">¬°Inicia la conversaci√≥n!</h3>\r\n                    <p className=\"text-gray-500\">Env√≠a tu primer mensaje</p>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-2\">\r\n                  {messages.map((msg) => (\r\n                    <MessageItem\r\n                      key={msg.id}\r\n                      msg={msg}\r\n                      currentUser={currentUser}\r\n                      onEdit={startEdit}\r\n                      onDelete={deleteMessage}\r\n                      isEditing={editingMessage === msg.id}\r\n                      editText={editText}\r\n                      onSaveEdit={saveEdit}\r\n                      onCancelEdit={cancelEdit}\r\n                      onSetEditText={setEditText}\r\n                    />\r\n                  ))}\r\n                  <div ref={messagesEndRef} />\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <form onSubmit={sendMessage} className=\"p-4 bg-white border-t border-gray-200 shadow-lg\">\r\n              <div className=\"flex space-x-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={newMessage}\r\n                  onChange={handleTyping}\r\n                  placeholder=\"Escribe un mensaje...\"\r\n                  className=\"flex-1 p-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\r\n                  disabled={isSending}\r\n                />\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={!newMessage.trim() || isSending}\r\n                  className=\"px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed font-bold flex items-center space-x-2\"\r\n                >\r\n                  {isSending ? (\r\n                    <>\r\n                      <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\r\n                      <span>Enviando...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <span>Enviar</span>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\r\n                      </svg>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </>\r\n        ) : (\r\n          <div className=\"flex-1 flex items-center justify-center bg-gradient-to-br from-gray-50 to-blue-50\">\r\n            <div className=\"text-center max-w-md\">\r\n              <div className=\"w-32 h-32 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-8\">\r\n                <span className=\"text-6xl\">üí¨</span>\r\n              </div>\r\n              <h3 className=\"text-3xl font-bold text-gray-900 mb-4\">\r\n                Bienvenido al chat\r\n              </h3>\r\n              <p className=\"text-gray-600 text-lg mb-8\">\r\n                {currentUser.rol === \"admin\" \r\n                  ? \"Selecciona un t√©cnico para empezar a conversar\" \r\n                  : \"Espera a que el administrador inicie una conversaci√≥n contigo\"}\r\n              </p>\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">üöÄ</div>\r\n                  <p className=\"font-medium\">Chat en tiempo real</p>\r\n                </div>\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">üì±</div>\r\n                  <p className=\"font-medium\">Responsive design</p>\r\n                </div>\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">üîî</div>\r\n                  <p className=\"font-medium\">Notificaciones</p>\r\n                </div>\r\n                <div className=\"p-4 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n                  <div className=\"text-2xl mb-2\">‚úèÔ∏è</div>\r\n                  <p className=\"font-medium\">Editar mensajes</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}