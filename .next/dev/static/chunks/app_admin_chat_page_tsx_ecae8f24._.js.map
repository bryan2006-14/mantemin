{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BRAYAN/Desktop/mantemin2.0/app/admin/chat/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n\r\ninterface Message {\r\n  id: string;\r\n  conversation_id: string;\r\n  sender_id: string;\r\n  sender_type: string;\r\n  message: string;\r\n  created_at: string;\r\n  read: boolean;\r\n}\r\n\r\ninterface Conversation {\r\n  id: string;\r\n  admin_id: string;\r\n  technician_id: string;\r\n  last_message: string;\r\n  updated_at: string;\r\n  other_user_name?: string;\r\n}\r\n\r\ninterface Usuario {\r\n  id: string;\r\n  email: string;\r\n  nombre: string;\r\n  rol: string;\r\n}\r\n\r\nexport default function ChatAdminTechnician() {\r\n  const [currentUser, setCurrentUser] = useState<Usuario | null>(null);\r\n  const [conversations, setConversations] = useState<Conversation[]>([]);\r\n  const [technicians, setTechnicians] = useState<Usuario[]>([]);\r\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Cargar usuario actual\r\n  useEffect(() => {\r\n    loadCurrentUser();\r\n  }, []);\r\n\r\n  // Cargar conversaciones y t√©cnicos\r\n  useEffect(() => {\r\n    if (currentUser) {\r\n      console.log(\"‚úÖ Current user:\", currentUser);\r\n      if (currentUser.rol === \"admin\") {\r\n        loadTechnicians();\r\n      }\r\n      loadConversations();\r\n    }\r\n  }, [currentUser]);\r\n\r\n  // Cargar mensajes cuando se selecciona conversaci√≥n\r\n  useEffect(() => {\r\n    if (selectedConversation) {\r\n      loadMessages(selectedConversation);\r\n      markMessagesAsRead(selectedConversation);\r\n    }\r\n  }, [selectedConversation]);\r\n\r\n  // Suscripci√≥n en tiempo real a mensajes\r\n  useEffect(() => {\r\n    if (selectedConversation) {\r\n      const channel = supabase\r\n        .channel(`messages:${selectedConversation}`)\r\n        .on(\r\n          \"postgres_changes\",\r\n          {\r\n            event: \"INSERT\",\r\n            schema: \"public\",\r\n            table: \"messages\",\r\n            filter: `conversation_id=eq.${selectedConversation}`,\r\n          },\r\n          (payload) => {\r\n            console.log(\"üì© Nuevo mensaje recibido:\", payload.new);\r\n            setMessages((prev) => [...prev, payload.new as Message]);\r\n            scrollToBottom();\r\n          }\r\n        )\r\n        .subscribe();\r\n\r\n      return () => {\r\n        supabase.removeChannel(channel);\r\n      };\r\n    }\r\n  }, [selectedConversation]);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const loadCurrentUser = async () => {\r\n    try {\r\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n      \r\n      if (authError || !user) {\r\n        setError(\"‚ùå No hay usuario autenticado\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      console.log(\"üîê Auth user:\", user.id);\r\n\r\n      // Buscar en tabla usuarios\r\n      const { data: usuario, error: usuarioError } = await supabase\r\n        .from(\"usuarios\")\r\n        .select(\"*\")\r\n        .eq(\"id\", user.id)\r\n        .single();\r\n      \r\n      if (usuarioError || !usuario) {\r\n        console.error(\"‚ùå Error loading usuario:\", usuarioError);\r\n        setError(\"No se encontr√≥ el usuario en la base de datos\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      console.log(\"‚úÖ Usuario cargado:\", usuario);\r\n      setCurrentUser(usuario);\r\n      setLoading(false);\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error:\", err);\r\n      setError(\"Error general: \" + err.message);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadTechnicians = async () => {\r\n    try {\r\n      console.log(\"üîß Cargando t√©cnicos...\");\r\n      const { data, error } = await supabase\r\n        .from(\"usuarios\")\r\n        .select(\"*\")\r\n        .eq(\"rol\", \"tecnico\");\r\n      \r\n      if (error) {\r\n        console.error(\"‚ùå Error loading technicians:\", error);\r\n        return;\r\n      }\r\n\r\n      console.log(\"‚úÖ T√©cnicos cargados:\", data?.length || 0);\r\n      if (data) {\r\n        setTechnicians(data);\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error:\", err);\r\n    }\r\n  };\r\n\r\n  const loadConversations = async () => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      console.log(\"üí¨ Cargando conversaciones para:\", currentUser.rol);\r\n      \r\n      let query;\r\n      if (currentUser.rol === \"admin\") {\r\n        query = supabase.from(\"conversations\").select(\"*\").eq(\"admin_id\", currentUser.id);\r\n      } else {\r\n        query = supabase.from(\"conversations\").select(\"*\").eq(\"technician_id\", currentUser.id);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n      \r\n      if (error) {\r\n        console.error(\"‚ùå Error loading conversations:\", error);\r\n        return;\r\n      }\r\n\r\n      console.log(\"‚úÖ Conversaciones encontradas:\", data?.length || 0);\r\n      \r\n      if (data && data.length > 0) {\r\n        // Cargar nombres del otro usuario\r\n        const conversationsWithNames = await Promise.all(\r\n          data.map(async (conv) => {\r\n            const otherId = currentUser.rol === \"admin\" ? conv.technician_id : conv.admin_id;\r\n            \r\n            const { data: otherUser } = await supabase\r\n              .from(\"usuarios\")\r\n              .select(\"nombre, email\")\r\n              .eq(\"id\", otherId)\r\n              .single();\r\n            \r\n            return {\r\n              ...conv,\r\n              other_user_name: otherUser?.nombre || otherUser?.email || \"Usuario\"\r\n            };\r\n          })\r\n        );\r\n        \r\n        setConversations(conversationsWithNames);\r\n      } else {\r\n        setConversations([]);\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error:\", err);\r\n    }\r\n  };\r\n\r\n  const loadMessages = async (conversationId: string) => {\r\n    try {\r\n      console.log(\"üì® Cargando mensajes de conversaci√≥n:\", conversationId);\r\n      const { data, error } = await supabase\r\n        .from(\"messages\")\r\n        .select(\"*\")\r\n        .eq(\"conversation_id\", conversationId)\r\n        .order(\"created_at\", { ascending: true });\r\n      \r\n      if (error) {\r\n        console.error(\"‚ùå Error loading messages:\", error);\r\n        return;\r\n      }\r\n\r\n      console.log(\"‚úÖ Mensajes cargados:\", data?.length || 0);\r\n      if (data) setMessages(data);\r\n    } catch (err) {\r\n      console.error(\"‚ùå Error:\", err);\r\n    }\r\n  };\r\n\r\n  const markMessagesAsRead = async (conversationId: string) => {\r\n    if (!currentUser) return;\r\n\r\n    const senderType = currentUser.rol === \"admin\" ? \"admin\" : \"technician\";\r\n\r\n    await supabase\r\n      .from(\"messages\")\r\n      .update({ read: true })\r\n      .eq(\"conversation_id\", conversationId)\r\n      .neq(\"sender_type\", senderType);\r\n  };\r\n\r\n  const startConversation = async (technicianId: string) => {\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      console.log(\"üÜï Iniciando conversaci√≥n con t√©cnico:\", technicianId);\r\n      \r\n      // Verificar si ya existe conversaci√≥n\r\n      const { data: existing, error: searchError } = await supabase\r\n        .from(\"conversations\")\r\n        .select(\"*\")\r\n        .eq(\"admin_id\", currentUser.id)\r\n        .eq(\"technician_id\", technicianId)\r\n        .maybeSingle();\r\n\r\n      if (searchError) {\r\n        console.error(\"‚ùå Error buscando conversaci√≥n:\", searchError);\r\n        return;\r\n      }\r\n\r\n      if (existing) {\r\n        console.log(\"‚úÖ Conversaci√≥n ya existe:\", existing.id);\r\n        setSelectedConversation(existing.id);\r\n        return;\r\n      }\r\n\r\n      // Crear nueva conversaci√≥n\r\n      console.log(\"üÜï Creando nueva conversaci√≥n...\");\r\n      const { data: newConv, error: insertError } = await supabase\r\n        .from(\"conversations\")\r\n        .insert({\r\n          admin_id: currentUser.id,\r\n          technician_id: technicianId,\r\n          last_message: \"\",\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (insertError) {\r\n        console.error(\"‚ùå Error creando conversaci√≥n:\", insertError);\r\n        setError(\"Error al crear conversaci√≥n: \" + insertError.message);\r\n        return;\r\n      }\r\n\r\n      console.log(\"‚úÖ Conversaci√≥n creada:\", newConv.id);\r\n      if (newConv) {\r\n        loadConversations();\r\n        setSelectedConversation(newConv.id);\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Error:\", err);\r\n      setError(\"Error: \" + err.message);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !selectedConversation || !currentUser) return;\r\n\r\n    const senderType = currentUser.rol === \"admin\" ? \"admin\" : \"technician\";\r\n\r\n    console.log(\"üì§ Enviando mensaje...\", { senderType, sender_id: currentUser.id });\r\n\r\n    const { error } = await supabase.from(\"messages\").insert({\r\n      conversation_id: selectedConversation,\r\n      sender_id: currentUser.id,\r\n      sender_type: senderType,\r\n      message: newMessage.trim(),\r\n    });\r\n\r\n    if (error) {\r\n      console.error(\"‚ùå Error enviando mensaje:\", error);\r\n      setError(\"Error al enviar mensaje: \" + error.message);\r\n      return;\r\n    }\r\n\r\n    console.log(\"‚úÖ Mensaje enviado\");\r\n\r\n    // Actualizar √∫ltima mensaje en conversaci√≥n\r\n    await supabase\r\n      .from(\"conversations\")\r\n      .update({\r\n        last_message: newMessage.trim(),\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"id\", selectedConversation);\r\n\r\n    setNewMessage(\"\");\r\n    loadConversations();\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gray-100\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Cargando chat...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gray-100\">\r\n        <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-8\">\r\n          <div className=\"text-center mb-4\">\r\n            <span className=\"text-6xl\">‚ö†Ô∏è</span>\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold text-red-600 mb-4\">Error</h2>\r\n          <p className=\"text-gray-700 mb-4\">{error}</p>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-4 w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n          >\r\n            Recargar p√°gina\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!currentUser) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gray-100\">\r\n        <div className=\"text-center bg-white p-8 rounded-lg shadow-lg\">\r\n          <span className=\"text-6xl mb-4 block\">üîí</span>\r\n          <h2 className=\"text-2xl font-bold mb-2\">No autenticado</h2>\r\n          <p className=\"text-gray-600\">Por favor inicia sesi√≥n</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-gray-100\">\r\n      {/* Sidebar - Lista de conversaciones */}\r\n      <div className=\"w-80 bg-white border-r border-gray-200 flex flex-col\">\r\n        <div className=\"p-4 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-purple-600\">\r\n          <h2 className=\"text-xl font-bold text-white\">üí¨ Mensajes</h2>\r\n          <p className=\"text-sm text-blue-100\">\r\n            {currentUser?.rol === \"admin\" ? \"Chat con T√©cnicos\" : \"Chat con Admin\"}\r\n          </p>\r\n          <p className=\"text-xs text-blue-200 mt-1\">\r\n            üë§ {currentUser.nombre}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Bot√≥n para iniciar nueva conversaci√≥n (solo admin) */}\r\n        {currentUser?.rol === \"admin\" && (\r\n          <div className=\"p-4 border-b border-gray-200\">\r\n            {technicians.length === 0 ? (\r\n              <div className=\"text-center p-4 bg-yellow-50 rounded-lg\">\r\n                <p className=\"text-sm text-yellow-700\">‚ö†Ô∏è No hay t√©cnicos disponibles</p>\r\n              </div>\r\n            ) : (\r\n              <select\r\n                onChange={(e) => {\r\n                  if (e.target.value) startConversation(e.target.value);\r\n                }}\r\n                value=\"\"\r\n                className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n              >\r\n                <option value=\"\">‚ûï Nueva conversaci√≥n ({technicians.length} t√©cnicos)</option>\r\n                {technicians.map((tech) => (\r\n                  <option key={tech.id} value={tech.id}>\r\n                    {tech.nombre}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Lista de conversaciones */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          {conversations.length === 0 ? (\r\n            <div className=\"p-4 text-center text-gray-500\">\r\n              <p className=\"text-4xl mb-2\">üí¨</p>\r\n              <p className=\"font-semibold\">No hay conversaciones</p>\r\n              {currentUser.rol === \"admin\" ? (\r\n                <p className=\"text-sm mt-2\">Selecciona un t√©cnico arriba</p>\r\n              ) : (\r\n                <p className=\"text-sm mt-2\">Espera a que el admin te contacte</p>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            conversations.map((conv) => (\r\n              <div\r\n                key={conv.id}\r\n                onClick={() => setSelectedConversation(conv.id)}\r\n                className={`p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition ${\r\n                  selectedConversation === conv.id ? \"bg-blue-50 border-l-4 border-l-blue-600\" : \"\"\r\n                }`}\r\n              >\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-lg\">\r\n                    {conv.other_user_name?.charAt(0).toUpperCase()}\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <h4 className=\"font-semibold text-gray-900 truncate\">\r\n                      {conv.other_user_name}\r\n                    </h4>\r\n                    <p className=\"text-sm text-gray-500 truncate\">\r\n                      {conv.last_message || \"Sin mensajes\"}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Panel de chat */}\r\n      <div className=\"flex-1 flex flex-col\">\r\n        {selectedConversation ? (\r\n          <>\r\n            {/* Header del chat */}\r\n            <div className=\"p-4 bg-white border-b border-gray-200 shadow-sm\">\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-10 h-10 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold\">\r\n                  {conversations\r\n                    .find((c) => c.id === selectedConversation)\r\n                    ?.other_user_name?.charAt(0)\r\n                    .toUpperCase()}\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-bold text-gray-900\">\r\n                    {conversations.find((c) => c.id === selectedConversation)?.other_user_name}\r\n                  </h3>\r\n                  <p className=\"text-sm text-green-500 flex items-center\">\r\n                    <span className=\"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse\"></span>\r\n                    En l√≠nea\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Mensajes */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50\">\r\n              {messages.length === 0 ? (\r\n                <div className=\"flex items-center justify-center h-full\">\r\n                  <div className=\"text-center text-gray-400\">\r\n                    <p className=\"text-4xl mb-2\">üëã</p>\r\n                    <p>¬°Inicia la conversaci√≥n!</p>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                messages.map((msg) => {\r\n                  const isOwn = msg.sender_id === currentUser?.id;\r\n                  return (\r\n                    <div\r\n                      key={msg.id}\r\n                      className={`flex ${isOwn ? \"justify-end\" : \"justify-start\"}`}\r\n                    >\r\n                      <div\r\n                        className={`max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${\r\n                          isOwn\r\n                            ? \"bg-blue-600 text-white rounded-br-none\"\r\n                            : \"bg-white text-gray-900 rounded-bl-none shadow\"\r\n                        }`}\r\n                      >\r\n                        <p className=\"break-words\">{msg.message}</p>\r\n                        <p\r\n                          className={`text-xs mt-1 ${\r\n                            isOwn ? \"text-blue-200\" : \"text-gray-400\"\r\n                          }`}\r\n                        >\r\n                          {new Date(msg.created_at).toLocaleTimeString(\"es-PE\", {\r\n                            hour: \"2-digit\",\r\n                            minute: \"2-digit\",\r\n                          })}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })\r\n              )}\r\n              <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            {/* Input de mensaje */}\r\n            <form onSubmit={sendMessage} className=\"p-4 bg-white border-t border-gray-200\">\r\n              <div className=\"flex space-x-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={newMessage}\r\n                  onChange={(e) => setNewMessage(e.target.value)}\r\n                  placeholder=\"Escribe un mensaje...\"\r\n                  className=\"flex-1 p-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                />\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={!newMessage.trim()}\r\n                  className=\"px-6 py-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed font-bold\"\r\n                >\r\n                  Enviar üöÄ\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </>\r\n        ) : (\r\n          <div className=\"flex-1 flex items-center justify-center bg-gray-50\">\r\n            <div className=\"text-center\">\r\n              <div className=\"text-6xl mb-4\">üí¨</div>\r\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                Selecciona una conversaci√≥n\r\n              </h3>\r\n              <p className=\"text-gray-500\">\r\n                {currentUser.rol === \"admin\" \r\n                  ? \"Elige un t√©cnico para empezar a chatear\" \r\n                  : \"Espera a que el administrador inicie una conversaci√≥n\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}