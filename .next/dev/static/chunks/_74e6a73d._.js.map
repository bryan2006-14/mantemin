{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BRAYAN/Desktop/Proyecto_Bashi/mantemin/lib/supabaseClient.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n)\r\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,0MAAY"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BRAYAN/Desktop/Proyecto_Bashi/mantemin/app/admin/ordenes/%5Bid%5D/page.jsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\n\r\nexport default function OrdenPerfil() {\r\n  const { id } = useParams();\r\n  const router = useRouter();\r\n  const [orden, setOrden] = useState(null);\r\n  const [fileAntes, setFileAntes] = useState(null);\r\n  const [fileDespues, setFileDespues] = useState(null);\r\n\r\n  async function cargar() {\r\n    const { data } = await supabase.from(\"ordenes\")\r\n      .select(\"*, maquinas(*), usuarios(nombre), clientes(*)\")\r\n      .eq(\"id\", id)\r\n      .single();\r\n    setOrden(data);\r\n  }\r\n\r\n  useEffect(() => { cargar(); }, []);\r\n\r\n  async function subirFoto(file, tipo) {\r\n    if (!file) return;\r\n    const nombre = `ordenes/${id}/${tipo}-${Date.now()}-${file.name}`;\r\n    const { error: uploadErr } = await supabase.storage.from(\"fotos\").upload(nombre, file);\r\n    if (uploadErr) return alert(\"Error upload\");\r\n    const { publicUrl } = supabase.storage.from(\"fotos\").getPublicUrl(nombre);\r\n    // Insertar en tabla fotos\r\n    await supabase.from(\"fotos\").insert({ tarea_id: null, url: publicUrl.publicUrl, tipo: tipo, orden_id: id });\r\n    cargar();\r\n  }\r\n\r\n  async function cambiarEstado(nuevo) {\r\n    await supabase.from(\"ordenes\").update({ estado: nuevo }).eq(\"id\", id);\r\n    cargar();\r\n  }\r\n\r\n  if (!orden) return <div className=\"p-6\">Cargando...</div>;\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-3xl\">\r\n      <h1 className=\"text-2xl font-bold\">OT #{orden.id}</h1>\r\n      <p className=\"text-gray-600\">{orden.descripcion}</p>\r\n\r\n      <div className=\"mt-4 grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <p className=\"font-semibold\">Antes</p>\r\n          <input type=\"file\" onChange={e=>setFileAntes(e.target.files?.[0]||null)} />\r\n          <button onClick={()=>subirFoto(fileAntes, \"antes\")} className=\"mt-2 bg-blue-600 text-white px-3 py-1 rounded\">Subir foto antes</button>\r\n        </div>\r\n\r\n        <div>\r\n          <p className=\"font-semibold\">Después</p>\r\n          <input type=\"file\" onChange={e=>setFileDespues(e.target.files?.[0]||null)} />\r\n          <button onClick={()=>subirFoto(fileDespues, \"despues\")} className=\"mt-2 bg-blue-600 text-white px-3 py-1 rounded\">Subir foto después</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mt-6\">\r\n        <p className=\"font-semibold\">Fotos</p>\r\n        <div className=\"grid grid-cols-3 gap-3 mt-2\">\r\n          {/* obtener fotos relacionadas a esta orden */}\r\n          <FotosOrden ordenId={id} reload={() => cargar()} />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mt-6 space-x-2\">\r\n        <button onClick={() => cambiarEstado(\"en_proceso\")} className=\"bg-yellow-500 px-3 py-1 rounded\">Marcar en proceso</button>\r\n        <button onClick={() => cambiarEstado(\"finalizada\")} className=\"bg-green-600 px-3 py-1 rounded\">Marcar finalizada</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Componente pequeño para mostrar fotos\r\nfunction FotosOrden({ ordenId }) {\r\n  const [fotos, setFotos] = useState([]);\r\n  useEffect(()=>{ (async()=>{\r\n    const { data } = await supabase.from(\"fotos\").select(\"*\").eq(\"orden_id\", ordenId);\r\n    setFotos(data || []);\r\n  })(); }, [ordenId]);\r\n\r\n  return fotos.map(f => (\r\n    <div key={f.id} className=\"border rounded overflow-hidden\">\r\n      <img src={f.url} alt={f.tipo} className=\"w-full h-36 object-cover\" />\r\n      <div className=\"p-2 text-sm\">\r\n        <div>Tipo: {f.tipo}</div>\r\n      </div>\r\n    </div>\r\n  ));\r\n}\r\n"],"names":[],"mappings":"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"}}]
}