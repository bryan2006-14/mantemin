{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BRAYAN/Desktop/Proyecto_Bashi/mantemin/lib/supabaseClient.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n)\r\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,0MAAY"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BRAYAN/Desktop/Proyecto_Bashi/mantemin/components/MapRealtime.jsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport dynamic from \"next/dynamic\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\n\r\n// Importación dinámica correcta de react-leaflet\r\nconst MapContainer = dynamic(\r\n  () => import(\"react-leaflet\").then((mod) => mod.MapContainer),\r\n  { ssr: false }\r\n);\r\nconst TileLayer = dynamic(\r\n  () => import(\"react-leaflet\").then((mod) => mod.TileLayer),\r\n  { ssr: false }\r\n);\r\nconst Marker = dynamic(\r\n  () => import(\"react-leaflet\").then((mod) => mod.Marker),\r\n  { ssr: false }\r\n);\r\nconst Popup = dynamic(\r\n  () => import(\"react-leaflet\").then((mod) => mod.Popup),\r\n  { ssr: false }\r\n);\r\n\r\nexport default function MapRealtime() {\r\n  const [tecnicos, setTecnicos] = useState([]);\r\n  const [maquinas, setMaquinas] = useState([]);\r\n  const [isClient, setIsClient] = useState(false);\r\n\r\n  async function cargar() {\r\n    const { data: t } = await supabase\r\n      .from(\"tecnicos\")\r\n      .select(\"id, ubicacion_lat, ubicacion_lng, disponible, usuarios (nombre)\")\r\n      .order(\"id\");\r\n    const { data: m } = await supabase\r\n      .from(\"maquinas\")\r\n      .select(\"id, codigo, foto_url, horometro, ubicacion_lat, ubicacion_lng\");\r\n    setTecnicos(t || []);\r\n    setMaquinas(m || []);\r\n  }\r\n\r\n  useEffect(() => {\r\n    setIsClient(true);\r\n    \r\n    // Fix para los iconos de Leaflet\r\n    if (typeof window !== \"undefined\") {\r\n      const L = require(\"leaflet\");\r\n      delete L.Icon.Default.prototype._getIconUrl;\r\n      L.Icon.Default.mergeOptions({\r\n        iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\r\n        iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\r\n        shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\r\n      });\r\n    }\r\n\r\n    cargar();\r\n\r\n    const ch1 = supabase\r\n      .channel(\"ubicaciones\")\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"tecnicos\" },\r\n        (payload) => {\r\n          cargar();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    const ch2 = supabase\r\n      .channel(\"maquinas\")\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"maquinas\" },\r\n        (payload) => {\r\n          cargar();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(ch1);\r\n      supabase.removeChannel(ch2);\r\n    };\r\n  }, []);\r\n\r\n  // Center default (Lima)\r\n  const center = [-12.0464, -77.0428];\r\n\r\n  if (!isClient) {\r\n    return (\r\n      <div className=\"h-[620px] flex items-center justify-center bg-gray-100 rounded-lg\">\r\n        <p className=\"text-gray-500\">Cargando mapa...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-[620px]\">\r\n      <MapContainer center={center} zoom={12} className=\"h-full w-full rounded-lg shadow-lg\">\r\n        <TileLayer \r\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n        />\r\n        \r\n        {/* Marcadores de técnicos */}\r\n        {tecnicos\r\n          .filter((t) => t.ubicacion_lat && t.ubicacion_lng)\r\n          .map((t) => (\r\n            <Marker key={`tecnico-${t.id}`} position={[t.ubicacion_lat, t.ubicacion_lng]}>\r\n              <Popup>\r\n                <div className=\"p-2\">\r\n                  <b className=\"text-lg\">{t.usuarios?.nombre || \"Técnico\"}</b>\r\n                  <br />\r\n                  <span className={t.disponible ? \"text-green-600\" : \"text-red-600\"}>\r\n                    Disponible: {t.disponible ? \"Sí\" : \"No\"}\r\n                  </span>\r\n                </div>\r\n              </Popup>\r\n            </Marker>\r\n          ))}\r\n        \r\n        {/* Marcadores de máquinas */}\r\n        {maquinas\r\n          .filter((m) => m.ubicacion_lat && m.ubicacion_lng)\r\n          .map((m) => (\r\n            <Marker key={`maquina-${m.id}`} position={[m.ubicacion_lat, m.ubicacion_lng]}>\r\n              <Popup>\r\n                <div className=\"p-2\">\r\n                  <b className=\"text-lg\">{m.codigo}</b>\r\n                  <br />\r\n                  Horómetro: {m.horometro || \"N/A\"} hrs\r\n                  {m.foto_url && (\r\n                    <img \r\n                      src={m.foto_url} \r\n                      alt={m.codigo} \r\n                      className=\"mt-2 w-32 h-32 object-cover rounded\"\r\n                    />\r\n                  )}\r\n                </div>\r\n              </Popup>\r\n            </Marker>\r\n          ))}\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}